{"version":3,"sources":["webpack://blog/./node_modules/@datadog/browser-core/esm/boot/init.js","webpack://blog/./node_modules/@datadog/browser-core/esm/browser/cookie.js","webpack://blog/./node_modules/@datadog/browser-core/esm/browser/fetchProxy.js","webpack://blog/./node_modules/@datadog/browser-core/esm/browser/xhrProxy.js","webpack://blog/./node_modules/@datadog/browser-core/esm/domain/automaticErrorCollection.js","webpack://blog/./node_modules/@datadog/browser-core/esm/domain/transportConfiguration.js","webpack://blog/./node_modules/@datadog/browser-core/esm/domain/configuration.js","webpack://blog/./node_modules/@datadog/browser-core/esm/domain/internalMonitoring.js","webpack://blog/./node_modules/@datadog/browser-core/esm/domain/sessionManagement.js","webpack://blog/./node_modules/@datadog/browser-core/esm/domain/oldCookiesMigration.js","webpack://blog/./node_modules/@datadog/browser-core/esm/domain/tracekit/computeStackTrace.js","webpack://blog/./node_modules/@datadog/browser-core/esm/domain/tracekit/report.js","webpack://blog/./node_modules/@datadog/browser-core/esm/tools/boundedBuffer.js","webpack://blog/./node_modules/@datadog/browser-core/esm/tools/catchUserErrors.js","webpack://blog/./node_modules/@datadog/browser-core/esm/tools/context.js","webpack://blog/./node_modules/@datadog/browser-core/esm/tools/contextManager.js","webpack://blog/./node_modules/@datadog/browser-core/esm/tools/error.js","webpack://blog/./node_modules/@datadog/browser-core/esm/tools/limitModification.js","webpack://blog/./node_modules/@datadog/browser-core/esm/tools/observable.js","webpack://blog/./node_modules/@datadog/browser-core/esm/tools/timeUtils.js","webpack://blog/./node_modules/@datadog/browser-core/esm/tools/urlPolyfill.js","webpack://blog/./node_modules/@datadog/browser-core/esm/tools/utils.js","webpack://blog/./node_modules/@datadog/browser-core/esm/transport/transport.js"],"names":["BuildMode","makePublicApi","stub","publicApi","onReady","callback","Object","defineProperty","get","enumerable","defineGlobal","global","name","api","existingGlobalVariable","q","forEach","fn","commonInit","userConfiguration","buildEnv","configuration","internalMonitoring","checkCookiesAuthorized","options","console","warn","checkIsNotLocalFile","window","location","protocol","error","getCurrentSiteCache","COOKIE_ACCESS_DELAY","cacheCookieAccess","timeout","cache","hasCache","cacheAccess","clearTimeout","setTimeout","getCookie","set","value","expireDelay","setCookie","date","Date","setTime","getTime","expires","toUTCString","sameSite","crossSite","domain","secure","document","cookie","areCookiesAuthorized","undefined","testCookieName","testCookieValue","getCurrentSite","domainLevels","hostname","split","candidateDomain","pop","length","fetchProxySingleton","originalFetch","beforeSendCallbacks","onRequestCompleteCallbacks","startFetchProxy","fetch","input","init","responsePromise","context","beforeSend","call","this","afterSend","proxyFetch","push","onRequestComplete","resetFetchProxy","splice","method","url","startTime","_this","reportFetch","response","text","e_1","_a","label","duration","Error","status","trys","clone","sent","responseType","type","then","xhrProxySingleton","originalXhrOpen","originalXhrSend","startXhrProxy","XMLHttpRequest","prototype","open","send","_datadog_xhr","apply","arguments","xhrContext_1","originalOnreadystatechange_1","onreadystatechange","readyState","DONE","reportXhr_1","hasBeenReported_1","addEventListener","resetXhrProxy","filteredErrorsObservable","originalConsoleError","traceKitReportHandler","startAutomaticErrorCollection","errorObservable","handleCompleteRequest","request","isIntakeUrl","isRejected","isServerError","notify","message","format","resource","statusCode","source","stack","truncateResponse","trackNetworkError","params","_i","buildErrorFromParams","startConsoleTracking","stackTrace","_","errorObject","startRuntimeErrorTracking","errorCount","filteredErrorObservable","subscribe","maxErrorsByMinute","setInterval","filterErrors","isEnabled","firstErrorParam","param","map","formatConsoleParameters","join","stackTraceFormatter","requestErrorResponseLengthLimit","substring","ENDPOINTS","alternate","logs","rum","sessionReplay","trace","classic","Datacenter","INTAKE_SITE","CLASSIC_ALLOWED_SITES","computeTransportConfiguration","transportSettings","applicationId","buildMode","clientToken","env","proxyHost","sdkVersion","service","site","datacenter","version","intakeType","useAlternateIntakeDomains","getIntakeType","intakeUrls","settings","withReplica","sites","urls","endpointTypes","keys","sites_1","endpointTypes_1","endpointType","getHost","getIntakeUrls","replica","some","intakeUrl","indexOf","logsEndpoint","getEndpoint","rumEndpoint","sessionReplayEndpoint","traceEndpoint","internalMonitoringApiKey","internalMonitoringEndpoint","replicaTransportSettings","endpoint","getClassicHost","domainParts","extension","suffix","getAlternateHost","tags","datadogHost","host","proxyParameter","parameters","encodeURIComponent","DEFAULT_CONFIGURATION","allowedTracingOrigins","maxInternalMonitoringMessagesPerPage","resourceSampleRate","sampleRate","silentMultipleInit","trackInteractions","flushTimeout","maxBatchSize","maxMessageSize","batchBytesLimit","buildConfiguration","enableExperimentalFeatures","Array","isArray","catchUserErrors","cookieOptions","buildCookieOptions","feature","useSecureSessionCookie","useCrossSiteSessionCookie","mustUseSecureCookie","trackSessionAcrossSubdomains","StatusType","externalContextProvider","monitoringConfiguration","maxMessagesPerPage","sentMessageCount","startInternalMonitoring","batch","replicaBatch","primaryBatch","createMonitoringBatch","endpointUrl","withContext","view","referrer","href","add","contextualizedMessage","startMonitoringBatch","interval","monitor","drift","now","Math","abs","clearInterval","navigationStart","addMonitoringMessage","debug","navigationStartUTC","timeSpent","setExternalContextProvider","provider","monitored","__","descriptor","originalMethod","args","decorated","callMonitored","e","logErrorIfDebug","addToMonitoringBatch","kind","formatError","addErrorToMonitoringBatch","debugMode","log","logMessageIfDebug","info","setDebugMode","SESSION_EXPIRATION_DELAY","utils","SESSION_TIME_OUT_DELAY","VISIBILITY_CHECK_DELAY","startSessionManagement","productKey","computeSessionState","sessionCookie","sessionString","oldSessionId","oldRumType","oldLogsType","session","id","test","persistSession","tryOldCookiesMigration","renewObservable","currentSessionId","retrieveActiveSession","expandOrRenewSession","trackingType","isTracked","created","String","throttled","stop","capture","passive","stopCallbacks","trackActivity","expandSession","expandSessionWhenVisible","visibilityState","visibilityCheckInterval","trackVisibility","getId","getTrackingType","SESSION_ENTRY_REGEXP","SESSION_ENTRY_SEPARATOR","isValidSessionString","entry","matches","exec","key","retrieveSession","Number","expire","isActiveSession","clearSession","cookieString","UNKNOWN_FUNCTION","computeStackTrace","ex","depth","normalizedDepth","stacktrace","tryToGetString","parts","opera10Regex","opera11Regex","lines","line","element","column","func","computeStackTraceFromStacktraceProp","isEval","submatch","chrome","gecko","winjs","geckoEval","chromeEval","i","j","isNative","isUndefined","columnNumber","computeStackTraceFromStackProp","lineRE1","lineRE2","lineRE3","scripts","getElementsByTagName","inlineScriptBlocks","s","has","src","item","replace","computeStackTraceFromOperaMultiLineMessage","computeStackTraceByWalkingCallerChain","augmentStackTraceWithInitialElement","stackInfo","lineNo","initial","incomplete","unshift","partial","functionName","funcs","recursion","curr","caller","toString","result","candidate","property","object","hasOwnProperty","what","ERROR_TYPES_RE","report","lastExceptionStack","lastException","processLastException","oldOnerrorHandler","onErrorHandlerInstalled","onUnhandledRejectionHandlerInstalled","handlers","handler","onerror","traceKitWindowOnError","installGlobalHandler","onunhandledrejection","traceKitWindowOnUnhandledRejection","installGlobalUnhandledRejectionHandler","notifyHandlers","isWindowError","exception","inner","columnNo","errorObj","name_1","location_1","msg","groups","reason","currentLastExceptionStack","currentLastException","BoundedBuffer","limit","buffer","drain","errorMsg","err","isContextArray","isContext","combine","destination","sources","sources_1","mergeInto","createCircularReferenceChecker","deepClone","WeakSet","set_1","hasAlreadyBeenSeen","array","circularReferenceChecker","finalDestination","max","index","createContextManager","remove","newContext","ErrorSource","AGENT","CONSOLE","CUSTOM","LOGGER","NETWORK","SOURCE","formatUnknownError","nonErrorPrefix","toStackTraceString","formatErrorMessage","frame","limitModification","modifiableFieldPaths","modifier","path","originalValue","newValue","current","fields","field","isValidObjectContaining","Observable","observers","f","data","observer","toServerDuration","timeStampNow","relativeNow","performance","elapsed","start","end","getRelativeTime","timestamp","getNavigationStart","getTimeStamp","relativeTime","floor","timing","isURLSupported","normalizeUrl","buildUrl","isValidUrl","getOrigin","getPathName","pathname","base","URL","checkURLSupported","doc","anchorElement","createElement","baseElement","implementation","createHTMLDocument","head","appendChild","body","ResourceType","RequestType","ONE_SECOND","ONE_MINUTE","ONE_HOUR","ONE_KILO_BYTE","throttle","wait","pendingExecutionWithParameters","pendingTimeoutId","needLeadingExecution","leading","needTrailingExecution","trailing","inWaitPeriod","cancel","assign","target","toAssign","generateUUID","placeholder","parseInt","random","performDraw","threshold","round","num","decimals","toFixed","noop","jsonStringify","replacer","space","JSON","stringify","originalToJSON","hasToJSON","toJSON","originalProtoToJSON","getPrototypeOf","includes","search","find","predicate","isPercentage","isNumber","objectValues","values","objectEntries","isEmptyObject","mapValues","newObject","getGlobalObject","globalThis","configurable","globalObject","_dd_temp_","self","getLocationOrigin","getLinkElementOrigin","origin","sanitizedHost","findCommaSeparatedValue","rawString","RegExp","safeTruncate","lastChar","charCodeAt","slice","emitter","event","listener","addEventListeners","events","_b","once","wrappedListener","removeEventListener","runOnReadyState","expectedReadyState","HAS_MULTI_BYTES_CHARACTERS","HttpRequest","bytesLimit","withBatchTime","size","addBatchTime","navigator","sendBeacon","Batch","maxSize","beforeUnloadCallback","pushOnlyBuffer","upsertBuffer","bufferBytesSize","bufferMessageCount","flushOnVisibilityHidden","flushPeriodically","addOrUpdate","upsert","flush","messages","sizeInBytes","TextEncoder","encode","Blob","process","processedMessage","messageBytesSize","hasMessageFor","willReachedBytesLimitWith","isFull","removedMessage"],"mappings":"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","file":"ea014c25724c3bc7c47d7be43ed11a3a92958d3c-0ebfd1df362e36ce758b.js","sourcesContent":["import { __assign } from \"tslib\";\nimport { areCookiesAuthorized } from '../browser/cookie';\nimport { buildConfiguration } from '../domain/configuration';\nimport { setDebugMode, startInternalMonitoring } from '../domain/internalMonitoring';\nimport { catchUserErrors } from '../tools/catchUserErrors';\nexport function makePublicApi(stub) {\n  var publicApi = __assign(__assign({}, stub), {\n    // This API method is intentionally not monitored, since the only thing executed is the\n    // user-provided 'callback'.  All SDK usages executed in the callback should be monitored, and\n    // we don't want to interfer with the user uncaught exceptions.\n    onReady: function onReady(callback) {\n      callback();\n    }\n  }); // Add an \"hidden\" property to set debug mode. We define it that way to hide it\n  // as much as possible but of course it's not a real protection.\n\n\n  Object.defineProperty(publicApi, '_setDebug', {\n    get: function get() {\n      return setDebugMode;\n    },\n    enumerable: false\n  });\n  return publicApi;\n}\nexport function defineGlobal(global, name, api) {\n  var existingGlobalVariable = global[name];\n  global[name] = api;\n\n  if (existingGlobalVariable && existingGlobalVariable.q) {\n    existingGlobalVariable.q.forEach(function (fn) {\n      return catchUserErrors(fn, 'onReady callback threw an error:')();\n    });\n  }\n}\nexport var BuildMode;\n\n(function (BuildMode) {\n  BuildMode[\"RELEASE\"] = \"release\";\n  BuildMode[\"STAGING\"] = \"staging\";\n  BuildMode[\"E2E_TEST\"] = \"e2e-test\";\n})(BuildMode || (BuildMode = {}));\n\nexport function commonInit(userConfiguration, buildEnv) {\n  var configuration = buildConfiguration(userConfiguration, buildEnv);\n  var internalMonitoring = startInternalMonitoring(configuration);\n  return {\n    configuration: configuration,\n    internalMonitoring: internalMonitoring\n  };\n}\nexport function checkCookiesAuthorized(options) {\n  if (!areCookiesAuthorized(options)) {\n    console.warn('Cookies are not authorized, we will not send any data.');\n    return false;\n  }\n\n  return true;\n}\nexport function checkIsNotLocalFile() {\n  if (isLocalFile()) {\n    console.error('Execution is not allowed in the current context.');\n    return false;\n  }\n\n  return true;\n}\n\nfunction isLocalFile() {\n  return window.location.protocol === 'file:';\n}","import { findCommaSeparatedValue, generateUUID, ONE_SECOND } from '../tools/utils';\nexport var COOKIE_ACCESS_DELAY = ONE_SECOND;\nexport function cacheCookieAccess(name, options) {\n  var timeout;\n  var cache;\n  var hasCache = false;\n\n  var cacheAccess = function cacheAccess() {\n    hasCache = true;\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      hasCache = false;\n    }, COOKIE_ACCESS_DELAY);\n  };\n\n  return {\n    get: function get() {\n      if (hasCache) {\n        return cache;\n      }\n\n      cache = getCookie(name);\n      cacheAccess();\n      return cache;\n    },\n    set: function set(value, expireDelay) {\n      setCookie(name, value, expireDelay, options);\n      cache = value;\n      cacheAccess();\n    }\n  };\n}\nexport function setCookie(name, value, expireDelay, options) {\n  var date = new Date();\n  date.setTime(date.getTime() + expireDelay);\n  var expires = \"expires=\" + date.toUTCString();\n  var sameSite = options && options.crossSite ? 'none' : 'strict';\n  var domain = options && options.domain ? \";domain=\" + options.domain : '';\n  var secure = options && options.secure ? \";secure\" : '';\n  document.cookie = name + \"=\" + value + \";\" + expires + \";path=/;samesite=\" + sameSite + domain + secure;\n}\nexport function getCookie(name) {\n  return findCommaSeparatedValue(document.cookie, name);\n}\nexport function areCookiesAuthorized(options) {\n  if (document.cookie === undefined || document.cookie === null) {\n    return false;\n  }\n\n  try {\n    // Use a unique cookie name to avoid issues when the SDK is initialized multiple times during\n    // the test cookie lifetime\n    var testCookieName = \"dd_cookie_test_\" + generateUUID();\n    var testCookieValue = 'test';\n    setCookie(testCookieName, testCookieValue, ONE_SECOND, options);\n    return getCookie(testCookieName) === testCookieValue;\n  } catch (error) {\n    console.error(error);\n    return false;\n  }\n}\n/**\n * No API to retrieve it, number of levels for subdomain and suffix are unknown\n * strategy: find the minimal domain on which cookies are allowed to be set\n * https://web.dev/same-site-same-origin/#site\n */\n\nvar getCurrentSiteCache;\nexport function getCurrentSite() {\n  if (getCurrentSiteCache === undefined) {\n    // Use a unique cookie name to avoid issues when the SDK is initialized multiple times during\n    // the test cookie lifetime\n    var testCookieName = \"dd_site_test_\" + generateUUID();\n    var testCookieValue = 'test';\n    var domainLevels = window.location.hostname.split('.');\n    var candidateDomain = domainLevels.pop();\n\n    while (domainLevels.length && !getCookie(testCookieName)) {\n      candidateDomain = domainLevels.pop() + \".\" + candidateDomain;\n      setCookie(testCookieName, testCookieValue, ONE_SECOND, {\n        domain: candidateDomain\n      });\n    }\n\n    getCurrentSiteCache = candidateDomain;\n  }\n\n  return getCurrentSiteCache;\n}","import { __awaiter, __generator } from \"tslib\";\nimport { monitor, callMonitored } from '../domain/internalMonitoring';\nimport { computeStackTrace } from '../domain/tracekit';\nimport { toStackTraceString } from '../tools/error';\nimport { elapsed, relativeNow } from '../tools/timeUtils';\nimport { normalizeUrl } from '../tools/urlPolyfill';\nvar fetchProxySingleton;\nvar originalFetch;\nvar beforeSendCallbacks = [];\nvar onRequestCompleteCallbacks = [];\nexport function startFetchProxy() {\n  if (!fetchProxySingleton) {\n    proxyFetch();\n    fetchProxySingleton = {\n      beforeSend: function beforeSend(callback) {\n        beforeSendCallbacks.push(callback);\n      },\n      onRequestComplete: function onRequestComplete(callback) {\n        onRequestCompleteCallbacks.push(callback);\n      }\n    };\n  }\n\n  return fetchProxySingleton;\n}\nexport function resetFetchProxy() {\n  if (fetchProxySingleton) {\n    fetchProxySingleton = undefined;\n    beforeSendCallbacks.splice(0, beforeSendCallbacks.length);\n    onRequestCompleteCallbacks.splice(0, onRequestCompleteCallbacks.length);\n    window.fetch = originalFetch;\n  }\n}\n\nfunction proxyFetch() {\n  if (!window.fetch) {\n    return;\n  }\n\n  originalFetch = window.fetch;\n\n  window.fetch = function (input, init) {\n    var responsePromise;\n    var context = callMonitored(beforeSend, null, [input, init]);\n\n    if (context) {\n      responsePromise = originalFetch.call(this, context.input, context.init);\n      callMonitored(afterSend, null, [responsePromise, context]);\n    } else {\n      responsePromise = originalFetch.call(this, input, init);\n    }\n\n    return responsePromise;\n  };\n}\n\nfunction beforeSend(input, init) {\n  var method = init && init.method || typeof input === 'object' && input.method || 'GET';\n  var url = normalizeUrl(typeof input === 'object' && input.url || input);\n  var startTime = relativeNow();\n  var context = {\n    init: init,\n    input: input,\n    method: method,\n    startTime: startTime,\n    url: url\n  };\n  beforeSendCallbacks.forEach(function (callback) {\n    return callback(context);\n  });\n  return context;\n}\n\nfunction afterSend(responsePromise, context) {\n  var _this = this;\n\n  var reportFetch = function reportFetch(response) {\n    return __awaiter(_this, void 0, void 0, function () {\n      var text, e_1;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            context.duration = elapsed(context.startTime, relativeNow());\n            if (!('stack' in response || response instanceof Error)) return [3\n            /*break*/\n            , 1];\n            context.status = 0;\n            context.response = toStackTraceString(computeStackTrace(response));\n            onRequestCompleteCallbacks.forEach(function (callback) {\n              return callback(context);\n            });\n            return [3\n            /*break*/\n            , 6];\n\n          case 1:\n            if (!('status' in response)) return [3\n            /*break*/\n            , 6];\n            text = void 0;\n            _a.label = 2;\n\n          case 2:\n            _a.trys.push([2, 4,, 5]);\n\n            return [4\n            /*yield*/\n            , response.clone().text()];\n\n          case 3:\n            text = _a.sent();\n            return [3\n            /*break*/\n            , 5];\n\n          case 4:\n            e_1 = _a.sent();\n            text = \"Unable to retrieve response: \" + e_1;\n            return [3\n            /*break*/\n            , 5];\n\n          case 5:\n            context.response = text;\n            context.responseType = response.type;\n            context.status = response.status;\n            onRequestCompleteCallbacks.forEach(function (callback) {\n              return callback(context);\n            });\n            _a.label = 6;\n\n          case 6:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  responsePromise.then(monitor(reportFetch), monitor(reportFetch));\n}","/* eslint-disable no-underscore-dangle */\nimport { monitor, callMonitored } from '../domain/internalMonitoring';\nimport { elapsed, relativeNow } from '../tools/timeUtils';\nimport { normalizeUrl } from '../tools/urlPolyfill';\nvar xhrProxySingleton;\nvar beforeSendCallbacks = [];\nvar onRequestCompleteCallbacks = [];\nvar originalXhrOpen;\nvar originalXhrSend;\nexport function startXhrProxy() {\n  if (!xhrProxySingleton) {\n    proxyXhr();\n    xhrProxySingleton = {\n      beforeSend: function beforeSend(callback) {\n        beforeSendCallbacks.push(callback);\n      },\n      onRequestComplete: function onRequestComplete(callback) {\n        onRequestCompleteCallbacks.push(callback);\n      }\n    };\n  }\n\n  return xhrProxySingleton;\n}\nexport function resetXhrProxy() {\n  if (xhrProxySingleton) {\n    xhrProxySingleton = undefined;\n    beforeSendCallbacks.splice(0, beforeSendCallbacks.length);\n    onRequestCompleteCallbacks.splice(0, onRequestCompleteCallbacks.length);\n    XMLHttpRequest.prototype.open = originalXhrOpen;\n    XMLHttpRequest.prototype.send = originalXhrSend;\n  }\n}\n\nfunction proxyXhr() {\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  originalXhrOpen = XMLHttpRequest.prototype.open; // eslint-disable-next-line @typescript-eslint/unbound-method\n\n  originalXhrSend = XMLHttpRequest.prototype.send;\n\n  XMLHttpRequest.prototype.open = function (method, url) {\n    var _this = this;\n\n    callMonitored(function () {\n      // WARN: since this data structure is tied to the instance, it is shared by both logs and rum\n      // and can be used by different code versions depending on customer setup\n      // so it should stay compatible with older versions\n      _this._datadog_xhr = {\n        method: method,\n        startTime: -1,\n        url: normalizeUrl(url)\n      };\n    });\n    return originalXhrOpen.apply(this, arguments);\n  };\n\n  XMLHttpRequest.prototype.send = function () {\n    var _this = this;\n\n    callMonitored(function () {\n      if (_this._datadog_xhr) {\n        var xhrContext_1 = _this._datadog_xhr;\n        xhrContext_1.startTime = relativeNow();\n        var originalOnreadystatechange_1 = _this.onreadystatechange;\n\n        _this.onreadystatechange = function () {\n          if (this.readyState === XMLHttpRequest.DONE) {\n            callMonitored(reportXhr_1);\n          }\n\n          if (originalOnreadystatechange_1) {\n            originalOnreadystatechange_1.apply(this, arguments);\n          }\n        };\n\n        var hasBeenReported_1 = false;\n\n        var reportXhr_1 = function reportXhr_1() {\n          if (hasBeenReported_1) {\n            return;\n          }\n\n          hasBeenReported_1 = true;\n          xhrContext_1.duration = elapsed(xhrContext_1.startTime, relativeNow());\n          xhrContext_1.response = _this.response;\n          xhrContext_1.status = _this.status;\n          onRequestCompleteCallbacks.forEach(function (callback) {\n            return callback(xhrContext_1);\n          });\n        };\n\n        _this.addEventListener('loadend', monitor(reportXhr_1));\n\n        beforeSendCallbacks.forEach(function (callback) {\n          return callback(xhrContext_1, _this);\n        });\n      }\n    });\n    return originalXhrSend.apply(this, arguments);\n  };\n}","import { __assign, __spreadArrays } from \"tslib\";\nimport { resetFetchProxy, startFetchProxy } from '../browser/fetchProxy';\nimport { resetXhrProxy, startXhrProxy } from '../browser/xhrProxy';\nimport { ErrorSource, formatUnknownError, toStackTraceString, formatErrorMessage } from '../tools/error';\nimport { Observable } from '../tools/observable';\nimport { relativeNow } from '../tools/timeUtils';\nimport { jsonStringify, ONE_MINUTE, RequestType, find } from '../tools/utils';\nimport { monitor } from './internalMonitoring';\nimport { computeStackTrace, subscribe, unsubscribe } from './tracekit';\nvar filteredErrorsObservable;\nexport function startAutomaticErrorCollection(configuration) {\n  if (!filteredErrorsObservable) {\n    var errorObservable = new Observable();\n    trackNetworkError(configuration, errorObservable);\n    startConsoleTracking(configuration, errorObservable);\n    startRuntimeErrorTracking(errorObservable);\n    filteredErrorsObservable = filterErrors(configuration, errorObservable);\n  }\n\n  return filteredErrorsObservable;\n}\nexport function filterErrors(configuration, errorObservable) {\n  var errorCount = 0;\n  var filteredErrorObservable = new Observable();\n  errorObservable.subscribe(function (error) {\n    if (errorCount < configuration.maxErrorsByMinute) {\n      errorCount += 1;\n      filteredErrorObservable.notify(error);\n    } else if (errorCount === configuration.maxErrorsByMinute) {\n      errorCount += 1;\n      filteredErrorObservable.notify({\n        message: \"Reached max number of errors by minute: \" + configuration.maxErrorsByMinute,\n        source: ErrorSource.AGENT,\n        startTime: relativeNow()\n      });\n    }\n  });\n  setInterval(function () {\n    return errorCount = 0;\n  }, ONE_MINUTE);\n  return filteredErrorObservable;\n}\nvar originalConsoleError;\nexport function startConsoleTracking(configuration, errorObservable) {\n  originalConsoleError = console.error;\n  console.error = monitor(function () {\n    var params = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      params[_i] = arguments[_i];\n    }\n\n    originalConsoleError.apply(console, params);\n    errorObservable.notify(__assign(__assign({}, buildErrorFromParams(configuration, params)), {\n      source: ErrorSource.CONSOLE,\n      startTime: relativeNow()\n    }));\n  });\n}\n\nfunction buildErrorFromParams(configuration, params) {\n  if (configuration.isEnabled('console-stack')) {\n    var firstErrorParam = find(params, function (param) {\n      return param instanceof Error;\n    });\n    return {\n      message: __spreadArrays(['console error:'], params).map(function (param) {\n        return formatConsoleParameters(formatErrorMessage, param);\n      }).join(' '),\n      stack: firstErrorParam ? toStackTraceString(computeStackTrace(firstErrorParam)) : undefined\n    };\n  }\n\n  return {\n    message: __spreadArrays(['console error:'], params).map(function (param) {\n      return formatConsoleParameters(toStackTraceString, param);\n    }).join(' ')\n  };\n}\n\nexport function stopConsoleTracking() {\n  console.error = originalConsoleError;\n}\n\nfunction formatConsoleParameters(stackTraceFormatter, param) {\n  if (typeof param === 'string') {\n    return param;\n  }\n\n  if (param instanceof Error) {\n    return stackTraceFormatter(computeStackTrace(param));\n  }\n\n  return jsonStringify(param, undefined, 2);\n}\n\nvar traceKitReportHandler;\nexport function startRuntimeErrorTracking(errorObservable) {\n  traceKitReportHandler = function traceKitReportHandler(stackTrace, _, errorObject) {\n    var _a = formatUnknownError(stackTrace, errorObject, 'Uncaught'),\n        stack = _a.stack,\n        message = _a.message,\n        type = _a.type;\n\n    errorObservable.notify({\n      message: message,\n      stack: stack,\n      type: type,\n      source: ErrorSource.SOURCE,\n      startTime: relativeNow()\n    });\n  };\n\n  subscribe(traceKitReportHandler);\n}\nexport function stopRuntimeErrorTracking() {\n  unsubscribe(traceKitReportHandler);\n}\nexport function trackNetworkError(configuration, errorObservable) {\n  startXhrProxy().onRequestComplete(function (context) {\n    return handleCompleteRequest(RequestType.XHR, context);\n  });\n  startFetchProxy().onRequestComplete(function (context) {\n    return handleCompleteRequest(RequestType.FETCH, context);\n  });\n\n  function handleCompleteRequest(type, request) {\n    if (!configuration.isIntakeUrl(request.url) && (isRejected(request) || isServerError(request))) {\n      errorObservable.notify({\n        message: format(type) + \" error \" + request.method + \" \" + request.url,\n        resource: {\n          method: request.method,\n          statusCode: request.status,\n          url: request.url\n        },\n        source: ErrorSource.NETWORK,\n        stack: truncateResponse(request.response, configuration) || 'Failed to load',\n        startTime: request.startTime\n      });\n    }\n  }\n\n  return {\n    stop: function stop() {\n      resetXhrProxy();\n      resetFetchProxy();\n    }\n  };\n}\n\nfunction isRejected(request) {\n  return request.status === 0 && request.responseType !== 'opaque';\n}\n\nfunction isServerError(request) {\n  return request.status >= 500;\n}\n\nfunction truncateResponse(response, configuration) {\n  if (response && response.length > configuration.requestErrorResponseLengthLimit) {\n    return response.substring(0, configuration.requestErrorResponseLengthLimit) + \"...\";\n  }\n\n  return response;\n}\n\nfunction format(type) {\n  if (RequestType.XHR === type) {\n    return 'XHR';\n  }\n\n  return 'Fetch';\n}","var _a;\n\nimport { __assign } from \"tslib\";\nimport { BuildMode } from '../boot/init';\nimport { includes } from '../tools/utils';\nvar ENDPOINTS = {\n  alternate: {\n    logs: 'logs',\n    rum: 'rum',\n    sessionReplay: 'session-replay',\n    trace: 'trace'\n  },\n  classic: {\n    logs: 'browser',\n    rum: 'rum',\n    // session-replay has no classic endpoint\n    sessionReplay: undefined,\n    trace: 'public-trace'\n  }\n};\nexport var Datacenter = {\n  EU: 'eu',\n  US: 'us'\n};\nexport var INTAKE_SITE = (_a = {}, _a[Datacenter.EU] = 'datadoghq.eu', _a[Datacenter.US] = 'datadoghq.com', _a);\nvar CLASSIC_ALLOWED_SITES = [INTAKE_SITE[Datacenter.US], INTAKE_SITE[Datacenter.EU]];\nexport function computeTransportConfiguration(userConfiguration, buildEnv) {\n  var transportSettings = {\n    applicationId: userConfiguration.applicationId,\n    buildMode: buildEnv.buildMode,\n    clientToken: userConfiguration.clientToken,\n    env: userConfiguration.env,\n    proxyHost: userConfiguration.proxyHost,\n    sdkVersion: buildEnv.sdkVersion,\n    service: userConfiguration.service,\n    site: userConfiguration.site || INTAKE_SITE[userConfiguration.datacenter || buildEnv.datacenter],\n    version: userConfiguration.version\n  };\n  var intakeType = getIntakeType(transportSettings.site, userConfiguration);\n  var intakeUrls = getIntakeUrls(intakeType, transportSettings, userConfiguration.replica !== undefined);\n  var configuration = {\n    isIntakeUrl: function isIntakeUrl(url) {\n      return intakeUrls.some(function (intakeUrl) {\n        return url.indexOf(intakeUrl) === 0;\n      });\n    },\n    logsEndpoint: getEndpoint(intakeType, 'logs', transportSettings),\n    rumEndpoint: getEndpoint(intakeType, 'rum', transportSettings),\n    sessionReplayEndpoint: getEndpoint(intakeType, 'sessionReplay', transportSettings),\n    traceEndpoint: getEndpoint(intakeType, 'trace', transportSettings)\n  };\n\n  if (userConfiguration.internalMonitoringApiKey) {\n    configuration.internalMonitoringEndpoint = getEndpoint(intakeType, 'logs', transportSettings, 'browser-agent-internal-monitoring');\n  }\n\n  if (transportSettings.buildMode === BuildMode.E2E_TEST) {\n    configuration.internalMonitoringEndpoint = '<<< E2E INTERNAL MONITORING ENDPOINT >>>';\n    configuration.logsEndpoint = '<<< E2E LOGS ENDPOINT >>>';\n    configuration.rumEndpoint = '<<< E2E RUM ENDPOINT >>>';\n    configuration.sessionReplayEndpoint = '<<< E2E SESSION REPLAY ENDPOINT >>>';\n  }\n\n  if (transportSettings.buildMode === BuildMode.STAGING) {\n    if (userConfiguration.replica !== undefined) {\n      var replicaTransportSettings = __assign(__assign({}, transportSettings), {\n        applicationId: userConfiguration.replica.applicationId,\n        clientToken: userConfiguration.replica.clientToken,\n        site: INTAKE_SITE[Datacenter.US]\n      });\n\n      configuration.replica = {\n        applicationId: userConfiguration.replica.applicationId,\n        internalMonitoringEndpoint: getEndpoint(intakeType, 'logs', replicaTransportSettings, 'browser-agent-internal-monitoring'),\n        logsEndpoint: getEndpoint(intakeType, 'logs', replicaTransportSettings),\n        rumEndpoint: getEndpoint(intakeType, 'rum', replicaTransportSettings)\n      };\n    }\n  }\n\n  return configuration;\n}\n\nfunction getIntakeType(site, userConfiguration) {\n  return !userConfiguration.useAlternateIntakeDomains && includes(CLASSIC_ALLOWED_SITES, site) ? 'classic' : 'alternate';\n}\n\nfunction getIntakeUrls(intakeType, settings, withReplica) {\n  if (settings.proxyHost) {\n    return [\"https://\" + settings.proxyHost + \"/v1/input/\"];\n  }\n\n  var sites = [settings.site];\n\n  if (settings.buildMode === BuildMode.STAGING && withReplica) {\n    sites.push(INTAKE_SITE[Datacenter.US]);\n  }\n\n  var urls = [];\n  var endpointTypes = Object.keys(ENDPOINTS[intakeType]);\n\n  for (var _i = 0, sites_1 = sites; _i < sites_1.length; _i++) {\n    var site = sites_1[_i];\n\n    for (var _a = 0, endpointTypes_1 = endpointTypes; _a < endpointTypes_1.length; _a++) {\n      var endpointType = endpointTypes_1[_a];\n      urls.push(\"https://\" + getHost(intakeType, endpointType, site) + \"/v1/input/\");\n    }\n  }\n\n  return urls;\n}\n\nfunction getHost(intakeType, endpointType, site) {\n  return intakeType === 'classic' && getClassicHost(endpointType, site) || getAlternateHost(endpointType, site);\n}\n\nfunction getClassicHost(endpointType, site) {\n  var endpoint = ENDPOINTS.classic[endpointType];\n  return endpoint && endpoint + \"-http-intake.logs.\" + site;\n}\n\nfunction getAlternateHost(endpointType, site) {\n  var endpoint = ENDPOINTS.alternate[endpointType];\n  var domainParts = site.split('.');\n  var extension = domainParts.pop();\n  var suffix = domainParts.join('-') + \".\" + extension;\n  return endpoint + \".browser-intake-\" + suffix;\n}\n\nfunction getEndpoint(intakeType, endpointType, settings, source) {\n  var tags = \"sdk_version:\" + settings.sdkVersion + (\"\" + (settings.env ? \",env:\" + settings.env : '')) + (\"\" + (settings.service ? \",service:\" + settings.service : '')) + (\"\" + (settings.version ? \",version:\" + settings.version : ''));\n  var datadogHost = getHost(intakeType, endpointType, settings.site);\n  var host = settings.proxyHost ? settings.proxyHost : datadogHost;\n  var proxyParameter = settings.proxyHost ? \"ddhost=\" + datadogHost + \"&\" : '';\n  var applicationIdParameter = settings.applicationId ? \"_dd.application_id=\" + settings.applicationId + \"&\" : '';\n  var parameters = \"\" + applicationIdParameter + proxyParameter + \"ddsource=\" + (source || 'browser') + \"&ddtags=\" + encodeURIComponent(tags);\n  return \"https://\" + host + \"/v1/input/\" + settings.clientToken + \"?\" + parameters;\n}","import { __assign } from \"tslib\";\nimport { getCurrentSite } from '../browser/cookie';\nimport { catchUserErrors } from '../tools/catchUserErrors';\nimport { includes, ONE_KILO_BYTE, ONE_SECOND } from '../tools/utils';\nimport { computeTransportConfiguration } from './transportConfiguration';\nexport var DEFAULT_CONFIGURATION = {\n  allowedTracingOrigins: [],\n  maxErrorsByMinute: 3000,\n  maxInternalMonitoringMessagesPerPage: 15,\n  resourceSampleRate: 100,\n  sampleRate: 100,\n  silentMultipleInit: false,\n  trackInteractions: false,\n\n  /**\n   * arbitrary value, byte precision not needed\n   */\n  requestErrorResponseLengthLimit: 32 * ONE_KILO_BYTE,\n\n  /**\n   * flush automatically, aim to be lower than ALB connection timeout\n   * to maximize connection reuse.\n   */\n  flushTimeout: 30 * ONE_SECOND,\n\n  /**\n   * Logs intake limit\n   */\n  maxBatchSize: 50,\n  maxMessageSize: 256 * ONE_KILO_BYTE,\n\n  /**\n   * beacon payload max queue size implementation is 64kb\n   * ensure that we leave room for logs, rum and potential other users\n   */\n  batchBytesLimit: 16 * ONE_KILO_BYTE\n};\nexport function buildConfiguration(userConfiguration, buildEnv) {\n  var enableExperimentalFeatures = Array.isArray(userConfiguration.enableExperimentalFeatures) ? userConfiguration.enableExperimentalFeatures : [];\n\n  var configuration = __assign(__assign({\n    beforeSend: userConfiguration.beforeSend && catchUserErrors(userConfiguration.beforeSend, 'beforeSend threw an error:'),\n    cookieOptions: buildCookieOptions(userConfiguration),\n    isEnabled: function isEnabled(feature) {\n      return includes(enableExperimentalFeatures, feature);\n    },\n    service: userConfiguration.service\n  }, computeTransportConfiguration(userConfiguration, buildEnv)), DEFAULT_CONFIGURATION);\n\n  if ('allowedTracingOrigins' in userConfiguration) {\n    configuration.allowedTracingOrigins = userConfiguration.allowedTracingOrigins;\n  }\n\n  if ('sampleRate' in userConfiguration) {\n    configuration.sampleRate = userConfiguration.sampleRate;\n  }\n\n  if ('resourceSampleRate' in userConfiguration) {\n    configuration.resourceSampleRate = userConfiguration.resourceSampleRate;\n  }\n\n  if ('trackInteractions' in userConfiguration) {\n    configuration.trackInteractions = !!userConfiguration.trackInteractions;\n  }\n\n  return configuration;\n}\nexport function buildCookieOptions(userConfiguration) {\n  var cookieOptions = {};\n  cookieOptions.secure = mustUseSecureCookie(userConfiguration);\n  cookieOptions.crossSite = !!userConfiguration.useCrossSiteSessionCookie;\n\n  if (!!userConfiguration.trackSessionAcrossSubdomains) {\n    cookieOptions.domain = getCurrentSite();\n  }\n\n  return cookieOptions;\n}\n\nfunction mustUseSecureCookie(userConfiguration) {\n  return !!userConfiguration.useSecureSessionCookie || !!userConfiguration.useCrossSiteSessionCookie;\n}","import { __assign } from \"tslib\";\nimport { combine } from '../tools/context';\nimport { toStackTraceString } from '../tools/error';\nimport { assign, jsonStringify, ONE_MINUTE, ONE_SECOND } from '../tools/utils';\nimport { getTimeStamp, relativeNow } from '../tools/timeUtils';\nimport { Batch, HttpRequest } from '../transport/transport';\nimport { computeStackTrace } from './tracekit';\nvar StatusType;\n\n(function (StatusType) {\n  StatusType[\"info\"] = \"info\";\n  StatusType[\"error\"] = \"error\";\n})(StatusType || (StatusType = {}));\n\nvar monitoringConfiguration = {\n  maxMessagesPerPage: 0,\n  sentMessageCount: 0\n};\nvar externalContextProvider;\nexport function startInternalMonitoring(configuration) {\n  if (configuration.internalMonitoringEndpoint) {\n    var batch = startMonitoringBatch(configuration);\n    assign(monitoringConfiguration, {\n      batch: batch,\n      maxMessagesPerPage: configuration.maxInternalMonitoringMessagesPerPage,\n      sentMessageCount: 0\n    });\n    startMonitoringClockDrift();\n  }\n\n  return {\n    setExternalContextProvider: function setExternalContextProvider(provider) {\n      externalContextProvider = provider;\n    }\n  };\n}\n\nfunction startMonitoringBatch(configuration) {\n  var primaryBatch = createMonitoringBatch(configuration.internalMonitoringEndpoint);\n  var replicaBatch;\n\n  if (configuration.replica !== undefined) {\n    replicaBatch = createMonitoringBatch(configuration.replica.internalMonitoringEndpoint);\n  }\n\n  function createMonitoringBatch(endpointUrl) {\n    return new Batch(new HttpRequest(endpointUrl, configuration.batchBytesLimit), configuration.maxBatchSize, configuration.batchBytesLimit, configuration.maxMessageSize, configuration.flushTimeout);\n  }\n\n  function withContext(message) {\n    return combine({\n      date: new Date().getTime(),\n      view: {\n        referrer: document.referrer,\n        url: window.location.href\n      }\n    }, externalContextProvider !== undefined ? externalContextProvider() : {}, message);\n  }\n\n  return {\n    add: function add(message) {\n      var contextualizedMessage = withContext(message);\n      primaryBatch.add(contextualizedMessage);\n\n      if (replicaBatch) {\n        replicaBatch.add(contextualizedMessage);\n      }\n    }\n  };\n}\n\nexport function resetInternalMonitoring() {\n  monitoringConfiguration.batch = undefined;\n}\n\nfunction startMonitoringClockDrift() {\n  var interval = setInterval(monitor(function () {\n    var drift = Date.now() - getTimeStamp(relativeNow());\n\n    if (Math.abs(drift) > ONE_SECOND) {\n      clearInterval(interval);\n      var navigationStart = getTimeStamp(0);\n      addMonitoringMessage('clock drift detected', {\n        debug: {\n          navigationStartUTC: new Date(navigationStart).toUTCString(),\n          timeSpent: Date.now() - navigationStart,\n          drift: drift\n        }\n      });\n    }\n  }), ONE_MINUTE);\n}\n\nexport function monitored(_, __, descriptor) {\n  var originalMethod = descriptor.value;\n\n  descriptor.value = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    var decorated = monitoringConfiguration.batch ? monitor(originalMethod) : originalMethod;\n    return decorated.apply(this, args);\n  };\n}\nexport function monitor(fn) {\n  return function () {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return callMonitored(fn, this, arguments);\n  }; // consider output type has input type\n}\nexport function callMonitored(fn, context, args) {\n  try {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return fn.apply(context, args);\n  } catch (e) {\n    logErrorIfDebug(e);\n\n    try {\n      addErrorToMonitoringBatch(e);\n    } catch (e) {\n      logErrorIfDebug(e);\n    }\n  }\n}\nexport function addMonitoringMessage(message, context) {\n  logMessageIfDebug(message);\n  addToMonitoringBatch(__assign(__assign({\n    message: message\n  }, context), {\n    status: StatusType.info\n  }));\n}\nexport function addErrorToMonitoringBatch(e) {\n  addToMonitoringBatch(__assign(__assign({}, formatError(e)), {\n    status: StatusType.error\n  }));\n}\n\nfunction addToMonitoringBatch(message) {\n  if (monitoringConfiguration.batch && monitoringConfiguration.sentMessageCount < monitoringConfiguration.maxMessagesPerPage) {\n    monitoringConfiguration.sentMessageCount += 1;\n    monitoringConfiguration.batch.add(message);\n  }\n}\n\nfunction formatError(e) {\n  if (e instanceof Error) {\n    var stackTrace = computeStackTrace(e);\n    return {\n      error: {\n        kind: stackTrace.name,\n        stack: toStackTraceString(stackTrace)\n      },\n      message: stackTrace.message\n    };\n  }\n\n  return {\n    error: {\n      stack: 'Not an instance of error'\n    },\n    message: \"Uncaught \" + jsonStringify(e)\n  };\n}\n\nexport function setDebugMode(debugMode) {\n  monitoringConfiguration.debugMode = debugMode;\n}\n\nfunction logErrorIfDebug(e) {\n  if (monitoringConfiguration.debugMode) {\n    // Log as warn to not forward the logs.\n    console.warn('[INTERNAL ERROR]', e);\n  }\n}\n\nfunction logMessageIfDebug(message) {\n  if (monitoringConfiguration.debugMode) {\n    console.log('[MONITORING MESSAGE]', message);\n  }\n}","import { cacheCookieAccess, COOKIE_ACCESS_DELAY } from '../browser/cookie';\nimport { Observable } from '../tools/observable';\nimport * as utils from '../tools/utils';\nimport { monitor } from './internalMonitoring';\nimport { tryOldCookiesMigration } from './oldCookiesMigration';\nexport var SESSION_COOKIE_NAME = '_dd_s';\nexport var SESSION_EXPIRATION_DELAY = 15 * utils.ONE_MINUTE;\nexport var SESSION_TIME_OUT_DELAY = 4 * utils.ONE_HOUR;\nexport var VISIBILITY_CHECK_DELAY = utils.ONE_MINUTE;\n/**\n * Limit access to cookie to avoid performance issues\n */\n\nexport function startSessionManagement(options, productKey, computeSessionState) {\n  var sessionCookie = cacheCookieAccess(SESSION_COOKIE_NAME, options);\n  tryOldCookiesMigration(sessionCookie);\n  var renewObservable = new Observable();\n  var currentSessionId = retrieveActiveSession(sessionCookie).id;\n  var expandOrRenewSession = utils.throttle(monitor(function () {\n    var session = retrieveActiveSession(sessionCookie);\n\n    var _a = computeSessionState(session[productKey]),\n        trackingType = _a.trackingType,\n        isTracked = _a.isTracked;\n\n    session[productKey] = trackingType;\n\n    if (isTracked && !session.id) {\n      session.id = utils.generateUUID();\n      session.created = String(Date.now());\n    } // save changes and expand session duration\n\n\n    persistSession(session, sessionCookie); // If the session id has changed, notify that the session has been renewed\n\n    if (isTracked && currentSessionId !== session.id) {\n      currentSessionId = session.id;\n      renewObservable.notify();\n    }\n  }), COOKIE_ACCESS_DELAY).throttled;\n\n  var expandSession = function expandSession() {\n    var session = retrieveActiveSession(sessionCookie);\n    persistSession(session, sessionCookie);\n  };\n\n  expandOrRenewSession();\n  trackActivity(expandOrRenewSession);\n  trackVisibility(expandSession);\n  return {\n    getId: function getId() {\n      return retrieveActiveSession(sessionCookie).id;\n    },\n    getTrackingType: function getTrackingType() {\n      return retrieveActiveSession(sessionCookie)[productKey];\n    },\n    renewObservable: renewObservable\n  };\n}\nvar SESSION_ENTRY_REGEXP = /^([a-z]+)=([a-z0-9-]+)$/;\nvar SESSION_ENTRY_SEPARATOR = '&';\nexport function isValidSessionString(sessionString) {\n  return sessionString !== undefined && (sessionString.indexOf(SESSION_ENTRY_SEPARATOR) !== -1 || SESSION_ENTRY_REGEXP.test(sessionString));\n}\n\nfunction retrieveActiveSession(sessionCookie) {\n  var session = retrieveSession(sessionCookie);\n\n  if (isActiveSession(session)) {\n    return session;\n  }\n\n  clearSession(sessionCookie);\n  return {};\n}\n\nfunction isActiveSession(session) {\n  // created and expire can be undefined for versions which was not storing them\n  // these checks could be removed when older versions will not be available/live anymore\n  return (session.created === undefined || Date.now() - Number(session.created) < SESSION_TIME_OUT_DELAY) && (session.expire === undefined || Date.now() < Number(session.expire));\n}\n\nfunction retrieveSession(sessionCookie) {\n  var sessionString = sessionCookie.get();\n  var session = {};\n\n  if (isValidSessionString(sessionString)) {\n    sessionString.split(SESSION_ENTRY_SEPARATOR).forEach(function (entry) {\n      var matches = SESSION_ENTRY_REGEXP.exec(entry);\n\n      if (matches !== null) {\n        var key = matches[1],\n            value = matches[2];\n        session[key] = value;\n      }\n    });\n  }\n\n  return session;\n}\n\nexport function persistSession(session, cookie) {\n  if (utils.isEmptyObject(session)) {\n    clearSession(cookie);\n    return;\n  }\n\n  session.expire = String(Date.now() + SESSION_EXPIRATION_DELAY);\n  var cookieString = utils.objectEntries(session).map(function (_a) {\n    var key = _a[0],\n        value = _a[1];\n    return key + \"=\" + value;\n  }).join(SESSION_ENTRY_SEPARATOR);\n  cookie.set(cookieString, SESSION_EXPIRATION_DELAY);\n}\n\nfunction clearSession(cookie) {\n  cookie.set('', 0);\n}\n\nexport function stopSessionManagement() {\n  stopCallbacks.forEach(function (e) {\n    return e();\n  });\n  stopCallbacks = [];\n}\nvar stopCallbacks = [];\nexport function trackActivity(expandOrRenewSession) {\n  var stop = utils.addEventListeners(window, [\"click\"\n  /* CLICK */\n  , \"touchstart\"\n  /* TOUCH_START */\n  , \"keydown\"\n  /* KEY_DOWN */\n  , \"scroll\"\n  /* SCROLL */\n  ], expandOrRenewSession, {\n    capture: true,\n    passive: true\n  }).stop;\n  stopCallbacks.push(stop);\n}\n\nfunction trackVisibility(expandSession) {\n  var expandSessionWhenVisible = monitor(function () {\n    if (document.visibilityState === 'visible') {\n      expandSession();\n    }\n  });\n  var stop = utils.addEventListener(document, \"visibilitychange\"\n  /* VISIBILITY_CHANGE */\n  , expandSessionWhenVisible).stop;\n  stopCallbacks.push(stop);\n  var visibilityCheckInterval = setInterval(expandSessionWhenVisible, VISIBILITY_CHECK_DELAY);\n  stopCallbacks.push(function () {\n    clearInterval(visibilityCheckInterval);\n  });\n}","import { getCookie } from '../browser/cookie';\nimport { persistSession } from './sessionManagement';\nexport var OLD_SESSION_COOKIE_NAME = '_dd';\nexport var OLD_RUM_COOKIE_NAME = '_dd_r';\nexport var OLD_LOGS_COOKIE_NAME = '_dd_l'; // duplicate values to avoid dependency issues\n\nexport var RUM_SESSION_KEY = 'rum';\nexport var LOGS_SESSION_KEY = 'logs';\n/**\n * This migration should remain in the codebase as long as older versions are available/live\n * to allow older sdk versions to be upgraded to newer versions without compatibility issues.\n */\n\nexport function tryOldCookiesMigration(sessionCookie) {\n  var sessionString = sessionCookie.get();\n  var oldSessionId = getCookie(OLD_SESSION_COOKIE_NAME);\n  var oldRumType = getCookie(OLD_RUM_COOKIE_NAME);\n  var oldLogsType = getCookie(OLD_LOGS_COOKIE_NAME);\n\n  if (!sessionString) {\n    var session = {};\n\n    if (oldSessionId) {\n      session.id = oldSessionId;\n    }\n\n    if (oldLogsType && /^[01]$/.test(oldLogsType)) {\n      session[LOGS_SESSION_KEY] = oldLogsType;\n    }\n\n    if (oldRumType && /^[012]$/.test(oldRumType)) {\n      session[RUM_SESSION_KEY] = oldRumType;\n    }\n\n    persistSession(session, sessionCookie);\n  }\n}","import { report } from './report';\nvar UNKNOWN_FUNCTION = '?';\n/**\n * computeStackTrace: cross-browser stack traces in JavaScript\n *\n * Syntax:\n * ```js\n * s = computeStackTraceOfCaller([depth])\n * s = computeStackTrace(exception) // consider using report instead (see below)\n * ```\n *\n * Supports:\n *   - Firefox:  full stack trace with line numbers and unreliable column\n *               number on top frame\n *   - Opera 10: full stack trace with line and column numbers\n *   - Opera 9-: full stack trace with line numbers\n *   - Chrome:   full stack trace with line and column numbers\n *   - Safari:   line and column number for the topmost stacktrace element\n *               only\n *   - IE:       no line numbers whatsoever\n *\n * Tries to guess names of anonymous functions by looking for assignments\n * in the source code. In IE and Safari, we have to guess source file names\n * by searching for function bodies inside all page scripts. This will not\n * work for scripts that are loaded cross-domain.\n * Here be dragons: some function names may be guessed incorrectly, and\n * duplicate functions may be mismatched.\n *\n * computeStackTrace should only be used for tracing purposes.\n * Logging of unhandled exceptions should be done with report,\n * which builds on top of computeStackTrace and provides better\n * IE support by utilizing the window.onerror event to retrieve information\n * about the top of the stack.\n *\n * Note: In IE and Safari, no stack trace is recorded on the Error object,\n * so computeStackTrace instead walks its *own* chain of callers.\n * This means that:\n *  * in Safari, some methods may be missing from the stack trace;\n *  * in IE, the topmost function in the stack trace will always be the\n *    caller of computeStackTrace.\n *\n * This is okay for tracing (because you are likely to be calling\n * computeStackTrace from the function you want to be the topmost element\n * of the stack trace anyway), but not okay for logging unhandled\n * exceptions (because your catch block will likely be far away from the\n * inner function that actually caused the exception).\n *\n * Tracing example:\n * ```js\n *     function trace(message) {\n *         let stackInfo = computeStackTrace.ofCaller();\n *         let data = message + \"\\n\";\n *         for(let i in stackInfo.stack) {\n *             let item = stackInfo.stack[i];\n *             data += (item.func || '[anonymous]') + \"() in \" + item.url + \":\" + (item.line || '0') + \"\\n\";\n *         }\n *         if (window.console)\n *             console.info(data);\n *         else\n *             alert(data);\n *     }\n * ```\n * @memberof TraceKit\n * @namespace\n */\n\n/**\n * Computes a stack trace for an exception.\n * @param {Error} ex\n * @param {(string|number)=} depth\n * @memberof computeStackTrace\n */\n\nexport function computeStackTrace(ex, depth) {\n  var stack;\n  var normalizedDepth = depth === undefined ? 0 : +depth;\n\n  try {\n    // This must be tried first because Opera 10 *destroys*\n    // its stacktrace property if you try to access the stack\n    // property first!!\n    stack = computeStackTraceFromStacktraceProp(ex);\n\n    if (stack) {\n      return stack;\n    }\n  } catch (e) {\n    if (debug) {\n      throw e;\n    }\n  }\n\n  try {\n    stack = computeStackTraceFromStackProp(ex);\n\n    if (stack) {\n      return stack;\n    }\n  } catch (e) {\n    if (debug) {\n      throw e;\n    }\n  }\n\n  try {\n    stack = computeStackTraceFromOperaMultiLineMessage(ex);\n\n    if (stack) {\n      return stack;\n    }\n  } catch (e) {\n    if (debug) {\n      throw e;\n    }\n  }\n\n  try {\n    stack = computeStackTraceByWalkingCallerChain(ex, normalizedDepth + 1);\n\n    if (stack) {\n      return stack;\n    }\n  } catch (e) {\n    if (debug) {\n      throw e;\n    }\n  }\n\n  return {\n    message: tryToGetString(ex, 'message'),\n    name: tryToGetString(ex, 'name'),\n    stack: []\n  };\n}\nvar debug = false; // Contents of Exception in various browsers.\n//\n// SAFARI:\n// ex.message = Can't find variable: qq\n// ex.line = 59\n// ex.sourceId = 580238192\n// ex.sourceURL = http://...\n// ex.expressionBeginOffset = 96\n// ex.expressionCaretOffset = 98\n// ex.expressionEndOffset = 98\n// ex.name = ReferenceError\n//\n// FIREFOX:\n// ex.message = qq is not defined\n// ex.fileName = http://...\n// ex.lineNumber = 59\n// ex.columnNumber = 69\n// ex.stack = ...stack trace... (see the example below)\n// ex.name = ReferenceError\n//\n// CHROME:\n// ex.message = qq is not defined\n// ex.name = ReferenceError\n// ex.type = not_defined\n// ex.arguments = ['aa']\n// ex.stack = ...stack trace...\n//\n// INTERNET EXPLORER:\n// ex.message = ...\n// ex.name = ReferenceError\n//\n// OPERA:\n// ex.message = ...message... (see the example below)\n// ex.name = ReferenceError\n// ex.opera#sourceloc = 11  (pretty much useless, duplicates the info in ex.message)\n// ex.stacktrace = n/a; see 'opera:config#UserPrefs|Exceptions Have Stacktrace'\n\n/**\n * Computes stack trace information from the stack property.\n * Chrome and Gecko use this property.\n * @param {Error} ex\n * @return {?StackTrace} Stack trace information.\n * @memberof computeStackTrace\n */\n\nexport function computeStackTraceFromStackProp(ex) {\n  var stacktrace = tryToGetString(ex, 'stack');\n\n  if (!stacktrace) {\n    return;\n  } // eslint-disable-next-line  max-len\n\n\n  var chrome = /^\\s*at (.*?) ?\\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\\/).*?)(?::(\\d+))?(?::(\\d+))?\\)?\\s*$/i; // eslint-disable-next-line  max-len\n\n  var gecko = /^\\s*(.*?)(?:\\((.*?)\\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|capacitor|\\[native).*?|[^@]*bundle)(?::(\\d+))?(?::(\\d+))?\\s*$/i; // eslint-disable-next-line  max-len\n\n  var winjs = /^\\s*at (?:((?:\\[object object\\])?.+) )?\\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\\d+)(?::(\\d+))?\\)?\\s*$/i; // Used to additionally parse URL/line/column from eval frames\n\n  var isEval;\n  var geckoEval = /(\\S+) line (\\d+)(?: > eval line \\d+)* > eval/i;\n  var chromeEval = /\\((\\S*)(?::(\\d+))(?::(\\d+))\\)/;\n  var lines = stacktrace.split('\\n');\n  var stack = [];\n  var submatch;\n  var parts;\n  var element;\n\n  for (var i = 0, j = lines.length; i < j; i += 1) {\n    if (chrome.exec(lines[i])) {\n      parts = chrome.exec(lines[i]);\n      var isNative = parts[2] && parts[2].indexOf('native') === 0; // start of line\n\n      isEval = parts[2] && parts[2].indexOf('eval') === 0; // start of line\n\n      submatch = chromeEval.exec(parts[2]);\n\n      if (isEval && submatch) {\n        // throw out eval line/column and use top-most line/column number\n        parts[2] = submatch[1]; // url\n\n        parts[3] = submatch[2]; // line\n\n        parts[4] = submatch[3]; // column\n      }\n\n      element = {\n        args: isNative ? [parts[2]] : [],\n        column: parts[4] ? +parts[4] : undefined,\n        func: parts[1] || UNKNOWN_FUNCTION,\n        line: parts[3] ? +parts[3] : undefined,\n        url: !isNative ? parts[2] : undefined\n      };\n    } else if (winjs.exec(lines[i])) {\n      parts = winjs.exec(lines[i]);\n      element = {\n        args: [],\n        column: parts[4] ? +parts[4] : undefined,\n        func: parts[1] || UNKNOWN_FUNCTION,\n        line: +parts[3],\n        url: parts[2]\n      };\n    } else if (gecko.exec(lines[i])) {\n      parts = gecko.exec(lines[i]);\n      isEval = parts[3] && parts[3].indexOf(' > eval') > -1;\n      submatch = geckoEval.exec(parts[3]);\n\n      if (isEval && submatch) {\n        // throw out eval line/column and use top-most line number\n        parts[3] = submatch[1];\n        parts[4] = submatch[2];\n        parts[5] = undefined; // no column when eval\n      } else if (i === 0 && !parts[5] && !isUndefined(ex.columnNumber)) {\n        // FireFox uses this awesome columnNumber property for its top frame\n        // Also note, Firefox's column number is 0-based and everything else expects 1-based,\n        // so adding 1\n        // NOTE: this hack doesn't work if top-most frame is eval\n        stack[0].column = ex.columnNumber + 1;\n      }\n\n      element = {\n        args: parts[2] ? parts[2].split(',') : [],\n        column: parts[5] ? +parts[5] : undefined,\n        func: parts[1] || UNKNOWN_FUNCTION,\n        line: parts[4] ? +parts[4] : undefined,\n        url: parts[3]\n      };\n    } else {\n      continue;\n    }\n\n    if (!element.func && element.line) {\n      element.func = UNKNOWN_FUNCTION;\n    }\n\n    stack.push(element);\n  }\n\n  if (!stack.length) {\n    return;\n  }\n\n  return {\n    stack: stack,\n    message: tryToGetString(ex, 'message'),\n    name: tryToGetString(ex, 'name')\n  };\n}\n/**\n * Computes stack trace information from the stacktrace property.\n * Opera 10+ uses this property.\n * @param {Error} ex\n * @return {?StackTrace} Stack trace information.\n * @memberof computeStackTrace\n */\n\nfunction computeStackTraceFromStacktraceProp(ex) {\n  // Access and store the stacktrace property before doing ANYTHING\n  // else to it because Opera is not very good at providing it\n  // reliably in other circumstances.\n  var stacktrace = tryToGetString(ex, 'stacktrace');\n\n  if (!stacktrace) {\n    return;\n  }\n\n  var opera10Regex = / line (\\d+).*script (?:in )?(\\S+)(?:: in function (\\S+))?$/i; // eslint-disable-next-line  max-len\n\n  var opera11Regex = / line (\\d+), column (\\d+)\\s*(?:in (?:<anonymous function: ([^>]+)>|([^\\)]+))\\((.*)\\))? in (.*):\\s*$/i;\n  var lines = stacktrace.split('\\n');\n  var stack = [];\n  var parts;\n\n  for (var line = 0; line < lines.length; line += 2) {\n    var element = void 0;\n\n    if (opera10Regex.exec(lines[line])) {\n      parts = opera10Regex.exec(lines[line]);\n      element = {\n        args: [],\n        column: undefined,\n        func: parts[3],\n        line: +parts[1],\n        url: parts[2]\n      };\n    } else if (opera11Regex.exec(lines[line])) {\n      parts = opera11Regex.exec(lines[line]);\n      element = {\n        args: parts[5] ? parts[5].split(',') : [],\n        column: +parts[2],\n        func: parts[3] || parts[4],\n        line: +parts[1],\n        url: parts[6]\n      };\n    }\n\n    if (element) {\n      if (!element.func && element.line) {\n        element.func = UNKNOWN_FUNCTION;\n      }\n\n      element.context = [lines[line + 1]];\n      stack.push(element);\n    }\n  }\n\n  if (!stack.length) {\n    return;\n  }\n\n  return {\n    stack: stack,\n    message: tryToGetString(ex, 'message'),\n    name: tryToGetString(ex, 'name')\n  };\n}\n/**\n * NOT TESTED.\n * Computes stack trace information from an error message that includes\n * the stack trace.\n * Opera 9 and earlier use this method if the option to show stack\n * traces is turned on in opera:config.\n * @param {Error} ex\n * @return {?StackTrace} Stack information.\n * @memberof computeStackTrace\n */\n\n\nfunction computeStackTraceFromOperaMultiLineMessage(ex) {\n  // TODO: Clean this function up\n  // Opera includes a stack trace into the exception message. An example is:\n  //\n  // Statement on line 3: Undefined variable: undefinedFunc\n  // Backtrace:\n  //   Line 3 of linked script file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.js:\n  //   In function zzz\n  //         undefinedFunc(a);\n  //   Line 7 of inline#1 script in file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.html:\n  //   In function yyy\n  //           zzz(x, y, z);\n  //   Line 3 of inline#1 script in file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.html:\n  //   In function xxx\n  //           yyy(a, a, a);\n  //   Line 1 of function script\n  //     try { xxx('hi'); return false; } catch(ex) { report(ex); }\n  //   ...\n  var message = tryToGetString(ex, 'message');\n\n  if (!message) {\n    return;\n  }\n\n  var lines = message.split('\\n');\n\n  if (lines.length < 4) {\n    return;\n  }\n\n  var lineRE1 = /^\\s*Line (\\d+) of linked script ((?:file|https?|blob)\\S+)(?:: in function (\\S+))?\\s*$/i;\n  var lineRE2 = /^\\s*Line (\\d+) of inline#(\\d+) script in ((?:file|https?|blob)\\S+)(?:: in function (\\S+))?\\s*$/i;\n  var lineRE3 = /^\\s*Line (\\d+) of function script\\s*$/i;\n  var stack = [];\n  var scripts = window && window.document && window.document.getElementsByTagName('script');\n  var inlineScriptBlocks = [];\n  var parts;\n\n  for (var s in scripts) {\n    if (has(scripts, s) && !scripts[s].src) {\n      inlineScriptBlocks.push(scripts[s]);\n    }\n  }\n\n  for (var line = 2; line < lines.length; line += 2) {\n    var item = void 0;\n\n    if (lineRE1.exec(lines[line])) {\n      parts = lineRE1.exec(lines[line]);\n      item = {\n        args: [],\n        column: undefined,\n        func: parts[3],\n        line: +parts[1],\n        url: parts[2]\n      };\n    } else if (lineRE2.exec(lines[line])) {\n      parts = lineRE2.exec(lines[line]);\n      item = {\n        args: [],\n        column: undefined,\n        func: parts[4],\n        line: +parts[1],\n        url: parts[3]\n      };\n    } else if (lineRE3.exec(lines[line])) {\n      parts = lineRE3.exec(lines[line]);\n      var url = window.location.href.replace(/#.*$/, '');\n      item = {\n        url: url,\n        args: [],\n        column: undefined,\n        func: '',\n        line: +parts[1]\n      };\n    }\n\n    if (item) {\n      if (!item.func) {\n        item.func = UNKNOWN_FUNCTION;\n      }\n\n      item.context = [lines[line + 1]];\n      stack.push(item);\n    }\n  }\n\n  if (!stack.length) {\n    return; // could not parse multiline exception message as Opera stack trace\n  }\n\n  return {\n    stack: stack,\n    message: lines[0],\n    name: tryToGetString(ex, 'name')\n  };\n}\n/**\n * Adds information about the first frame to incomplete stack traces.\n * Safari and IE require this to get complete data on the first frame.\n * @param {StackTrace} stackInfo Stack trace information from\n * one of the compute* methods.\n * @param {string=} url The URL of the script that caused an error.\n * @param {(number|string)=} lineNo The line number of the script that\n * caused an error.\n * @param {string=} message The error generated by the browser, which\n * hopefully contains the name of the object that caused the error.\n * @return {boolean} Whether or not the stack information was\n * augmented.\n * @memberof computeStackTrace\n */\n\n\nexport function augmentStackTraceWithInitialElement(stackInfo, url, lineNo) {\n  var initial = {\n    url: url,\n    line: lineNo ? +lineNo : undefined\n  };\n\n  if (initial.url && initial.line) {\n    stackInfo.incomplete = false;\n    var stack = stackInfo.stack;\n\n    if (stack.length > 0) {\n      if (stack[0].url === initial.url) {\n        if (stack[0].line === initial.line) {\n          return false; // already in stack trace\n        }\n\n        if (!stack[0].line && stack[0].func === initial.func) {\n          stack[0].line = initial.line;\n          stack[0].context = initial.context;\n          return false;\n        }\n      }\n    }\n\n    stack.unshift(initial);\n    stackInfo.partial = true;\n    return true;\n  }\n\n  stackInfo.incomplete = true;\n  return false;\n}\n/**\n * Computes stack trace information by walking the arguments.caller\n * chain at the time the exception occurred. This will cause earlier\n * frames to be missed but is the only way to get any stack trace in\n * Safari and IE. The top frame is restored by\n * {@link augmentStackTraceWithInitialElement}.\n * @param {Error} ex\n * @param {number} depth\n * @return {StackTrace} Stack trace information.\n * @memberof computeStackTrace\n */\n\nfunction computeStackTraceByWalkingCallerChain(ex, depth) {\n  var functionName = /function\\s+([_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*)?\\s*\\(/i;\n  var stack = [];\n  var funcs = {};\n  var recursion = false;\n  var parts;\n  var item;\n\n  for (var curr = computeStackTraceByWalkingCallerChain.caller; curr && !recursion; curr = curr.caller) {\n    if (curr === computeStackTrace || curr === report) {\n      continue;\n    }\n\n    item = {\n      args: [],\n      column: undefined,\n      func: UNKNOWN_FUNCTION,\n      line: undefined,\n      url: undefined\n    };\n    parts = functionName.exec(curr.toString());\n\n    if (curr.name) {\n      item.func = curr.name;\n    } else if (parts) {\n      item.func = parts[1];\n    }\n\n    if (typeof item.func === 'undefined') {\n      item.func = parts ? parts.input.substring(0, parts.input.indexOf('{')) : undefined;\n    }\n\n    if (funcs[curr.toString()]) {\n      recursion = true;\n    } else {\n      funcs[curr.toString()] = true;\n    }\n\n    stack.push(item);\n  }\n\n  if (depth) {\n    stack.splice(0, depth);\n  }\n\n  var result = {\n    stack: stack,\n    message: tryToGetString(ex, 'message'),\n    name: tryToGetString(ex, 'name')\n  };\n  augmentStackTraceWithInitialElement(result, tryToGetString(ex, 'sourceURL') || tryToGetString(ex, 'fileName'), tryToGetString(ex, 'line') || tryToGetString(ex, 'lineNumber'));\n  return result;\n}\n\nfunction tryToGetString(candidate, property) {\n  if (typeof candidate !== 'object' || !candidate || !(property in candidate)) {\n    return undefined;\n  }\n\n  var value = candidate[property];\n  return typeof value === 'string' ? value : undefined;\n}\n/**\n * Logs a stacktrace starting from the previous call and working down.\n * @param {(number|string)=} depth How many frames deep to trace.\n * @return {StackTrace} Stack trace information.\n * @memberof computeStackTrace\n */\n\n\nexport function computeStackTraceOfCaller(depth) {\n  var currentDepth = (depth === undefined ? 0 : +depth) + 1; // \"+ 1\" because \"ofCaller\" should drop one frame\n\n  try {\n    throw new Error();\n  } catch (ex) {\n    return computeStackTrace(ex, currentDepth + 1);\n  }\n}\n/**\n * A better form of hasOwnProperty<br/>\n * Example: `has(MainHostObject, property) === true/false`\n *\n * @param {Object} object to check property\n * @param {string} key to check\n * @return {Boolean} true if the object has the key and it is not inherited\n */\n\nfunction has(object, key) {\n  return Object.prototype.hasOwnProperty.call(object, key);\n}\n/**\n * Returns true if the parameter is undefined<br/>\n * Example: `isUndefined(val) === true/false`\n *\n * @param {*} what Value to check\n * @return {Boolean} true if undefined and false otherwise\n */\n\n\nfunction isUndefined(what) {\n  return typeof what === 'undefined';\n}","import { monitor } from '../internalMonitoring';\nimport { computeStackTrace, augmentStackTraceWithInitialElement } from './computeStackTrace'; // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Error_types\n// eslint-disable-next-line  max-len\n\nvar ERROR_TYPES_RE = /^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;\n/**\n * Cross-browser processing of unhandled exceptions\n *\n * Syntax:\n * ```js\n *   subscribe(function(stackInfo) { ... })\n *   unsubscribe(function(stackInfo) { ... })\n *   report(exception)\n *   try { ...code... } catch(ex) { report(ex); }\n * ```\n *\n * Supports:\n *   - Firefox: full stack trace with line numbers, plus column number\n *     on top frame; column number is not guaranteed\n *   - Opera: full stack trace with line and column numbers\n *   - Chrome: full stack trace with line and column numbers\n *   - Safari: line and column number for the top frame only; some frames\n *     may be missing, and column number is not guaranteed\n *   - IE: line and column number for the top frame only; some frames\n *     may be missing, and column number is not guaranteed\n *\n * In theory, TraceKit should work on all of the following versions:\n *   - IE5.5+ (only 8.0 tested)\n *   - Firefox 0.9+ (only 3.5+ tested)\n *   - Opera 7+ (only 10.50 tested; versions 9 and earlier may require\n *     Exceptions Have Stacktrace to be enabled in opera:config)\n *   - Safari 3+ (only 4+ tested)\n *   - Chrome 1+ (only 5+ tested)\n *   - Konqueror 3.5+ (untested)\n *\n * Requires computeStackTrace.\n *\n * Tries to catch all unhandled exceptions and report them to the\n * subscribed handlers. Please note that report will rethrow the\n * exception. This is REQUIRED in order to get a useful stack trace in IE.\n * If the exception does not reach the top of the browser, you will only\n * get a stack trace from the point where report was called.\n *\n * Handlers receive a StackTrace object as described in the\n * computeStackTrace docs.\n *\n * @memberof TraceKit\n * @namespace\n */\n\n/**\n * Reports an unhandled Error.\n * @param {Error} ex\n * @memberof report\n * @throws An exception if an incomplete stack trace is detected (old IE browsers).\n */\n\nexport function report(ex) {\n  if (lastExceptionStack) {\n    if (lastException === ex) {\n      return; // already caught by an inner catch block, ignore\n    }\n\n    processLastException();\n  }\n\n  var stack = computeStackTrace(ex);\n  lastExceptionStack = stack;\n  lastException = ex; // If the stack trace is incomplete, wait for 2 seconds for\n  // slow slow IE to see if onerror occurs or not before reporting\n  // this exception; otherwise, we will end up with an incomplete\n  // stack trace\n\n  setTimeout(function () {\n    if (lastException === ex) {\n      processLastException();\n    }\n  }, stack.incomplete ? 2000 : 0);\n  throw ex; // re-throw to propagate to the top level (and cause window.onerror)\n}\nvar handlers = [];\nvar lastException;\nvar lastExceptionStack;\n/**\n * Add a crash handler.\n * @param {Function} handler\n * @memberof report\n */\n\nexport function subscribe(handler) {\n  installGlobalHandler();\n  installGlobalUnhandledRejectionHandler();\n  handlers.push(handler);\n}\n/**\n * Remove a crash handler.\n * @param {Function} handler\n * @memberof report\n */\n\nexport function unsubscribe(handler) {\n  for (var i = handlers.length - 1; i >= 0; i -= 1) {\n    if (handlers[i] === handler) {\n      handlers.splice(i, 1);\n    }\n  }\n\n  if (handlers.length === 0) {\n    uninstallGlobalHandler();\n    uninstallGlobalUnhandledRejectionHandler();\n  }\n}\n/**\n * Dispatch stack information to all handlers.\n * @param {StackTrace} stack\n * @param {boolean} isWindowError Is this a top-level window error?\n * @param {Error=} error The error that's being handled (if available, null otherwise)\n * @memberof report\n * @throws An exception if an error occurs while calling an handler.\n */\n\nfunction notifyHandlers(stack, isWindowError, error) {\n  var exception;\n  handlers.forEach(function (handler) {\n    try {\n      handler(stack, isWindowError, error);\n    } catch (inner) {\n      exception = inner;\n    }\n  });\n\n  if (exception) {\n    throw exception;\n  }\n}\n\nvar oldOnerrorHandler;\nvar onErrorHandlerInstalled;\nvar oldOnunhandledrejectionHandler;\nvar onUnhandledRejectionHandlerInstalled;\n/**\n * Ensures all global unhandled exceptions are recorded.\n * Supported by Gecko and IE.\n * @param {Event|string} message Error message.\n * @param {string=} url URL of script that generated the exception.\n * @param {(number|string)=} lineNo The line number at which the error occurred.\n * @param {(number|string)=} columnNo The column number at which the error occurred.\n * @param {Error=} errorObj The actual Error object.\n * @memberof report\n */\n\nexport function traceKitWindowOnError(message, url, lineNo, columnNo, errorObj) {\n  var stack;\n\n  if (lastExceptionStack) {\n    augmentStackTraceWithInitialElement(lastExceptionStack, url, lineNo);\n    processLastException();\n  } else if (errorObj) {\n    stack = computeStackTrace(errorObj);\n    notifyHandlers(stack, true, errorObj);\n  } else {\n    var location_1 = {\n      url: url,\n      column: columnNo,\n      line: lineNo\n    };\n    var name_1;\n    var msg = message;\n\n    if ({}.toString.call(message) === '[object String]') {\n      var groups = ERROR_TYPES_RE.exec(msg);\n\n      if (groups) {\n        name_1 = groups[1];\n        msg = groups[2];\n      }\n    }\n\n    stack = {\n      name: name_1,\n      message: typeof msg === 'string' ? msg : undefined,\n      stack: [location_1]\n    };\n    notifyHandlers(stack, true, message);\n  }\n\n  if (oldOnerrorHandler) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return oldOnerrorHandler.apply(this, arguments);\n  }\n\n  return false;\n}\n/**\n * Ensures all unhandled rejections are recorded.\n * @param {PromiseRejectionEvent} e event.\n * @memberof report\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onunhandledrejection\n * @see https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent\n */\n\nfunction traceKitWindowOnUnhandledRejection(e) {\n  var reason = e.reason || 'Empty reason';\n  var stack = computeStackTrace(reason);\n  notifyHandlers(stack, true, reason);\n}\n/**\n * Install a global onerror handler\n * @memberof report\n */\n\n\nfunction installGlobalHandler() {\n  if (onErrorHandlerInstalled) {\n    return;\n  }\n\n  oldOnerrorHandler = window.onerror;\n  window.onerror = monitor(traceKitWindowOnError);\n  onErrorHandlerInstalled = true;\n}\n/**\n * Uninstall the global onerror handler\n * @memberof report\n */\n\n\nfunction uninstallGlobalHandler() {\n  if (onErrorHandlerInstalled) {\n    window.onerror = oldOnerrorHandler;\n    onErrorHandlerInstalled = false;\n  }\n}\n/**\n * Install a global onunhandledrejection handler\n * @memberof report\n */\n\n\nfunction installGlobalUnhandledRejectionHandler() {\n  if (onUnhandledRejectionHandlerInstalled) {\n    return;\n  }\n\n  oldOnunhandledrejectionHandler = window.onunhandledrejection !== null ? window.onunhandledrejection : undefined;\n  window.onunhandledrejection = monitor(traceKitWindowOnUnhandledRejection);\n  onUnhandledRejectionHandlerInstalled = true;\n}\n/**\n * Uninstall the global onunhandledrejection handler\n * @memberof report\n */\n\n\nfunction uninstallGlobalUnhandledRejectionHandler() {\n  if (onUnhandledRejectionHandlerInstalled) {\n    window.onunhandledrejection = oldOnunhandledrejectionHandler;\n    onUnhandledRejectionHandlerInstalled = false;\n  }\n}\n/**\n * Process the most recent exception\n * @memberof report\n */\n\n\nfunction processLastException() {\n  var currentLastExceptionStack = lastExceptionStack;\n  var currentLastException = lastException;\n  lastExceptionStack = undefined;\n  lastException = undefined;\n  notifyHandlers(currentLastExceptionStack, false, currentLastException);\n}","var DEFAULT_LIMIT = 10000;\n\nvar BoundedBuffer =\n/** @class */\nfunction () {\n  function BoundedBuffer(limit) {\n    if (limit === void 0) {\n      limit = DEFAULT_LIMIT;\n    }\n\n    this.limit = limit;\n    this.buffer = [];\n  }\n\n  BoundedBuffer.prototype.add = function (item) {\n    var length = this.buffer.push(item);\n\n    if (length > this.limit) {\n      this.buffer.splice(0, 1);\n    }\n  };\n\n  BoundedBuffer.prototype.drain = function (fn) {\n    this.buffer.forEach(function (item) {\n      return fn(item);\n    });\n    this.buffer.length = 0;\n  };\n\n  return BoundedBuffer;\n}();\n\nexport { BoundedBuffer };","export function catchUserErrors(fn, errorMsg) {\n  return function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    try {\n      return fn.apply(void 0, args);\n    } catch (err) {\n      console.error(errorMsg, err);\n    }\n  };\n}","var isContextArray = function isContextArray(value) {\n  return Array.isArray(value);\n};\n\nvar isContext = function isContext(value) {\n  return !Array.isArray(value) && typeof value === 'object' && value !== null;\n};\n\nexport function combine() {\n  var sources = [];\n\n  for (var _i = 0; _i < arguments.length; _i++) {\n    sources[_i] = arguments[_i];\n  }\n\n  var destination;\n\n  for (var _a = 0, sources_1 = sources; _a < sources_1.length; _a++) {\n    var source = sources_1[_a]; // Ignore any undefined or null sources.\n\n    if (source === undefined || source === null) {\n      continue;\n    }\n\n    destination = mergeInto(destination, source, createCircularReferenceChecker());\n  }\n\n  return destination;\n}\n/*\n * Performs a deep clone of objects and arrays.\n * - Circular references are replaced by 'undefined'\n */\n\nexport function deepClone(context) {\n  return mergeInto(undefined, context, createCircularReferenceChecker());\n}\nexport function createCircularReferenceChecker() {\n  if (typeof WeakSet !== 'undefined') {\n    var set_1 = new WeakSet();\n    return {\n      hasAlreadyBeenSeen: function hasAlreadyBeenSeen(value) {\n        var has = set_1.has(value);\n\n        if (!has) {\n          set_1.add(value);\n        }\n\n        return has;\n      }\n    };\n  }\n\n  var array = [];\n  return {\n    hasAlreadyBeenSeen: function hasAlreadyBeenSeen(value) {\n      var has = array.indexOf(value) >= 0;\n\n      if (!has) {\n        array.push(value);\n      }\n\n      return has;\n    }\n  };\n}\n/**\n * Iterate over 'source' and affect its subvalues into 'destination', recursively.  If the 'source'\n * and 'destination' can't be merged, return 'source'.\n */\n\nexport function mergeInto(destination, source, circularReferenceChecker) {\n  // Ignore the 'source' if it is undefined\n  if (source === undefined) {\n    return destination;\n  } // If the 'source' is not an object or array, it can't be merged with 'destination' in any way, so\n  // return it directly.\n\n\n  if (!isContext(source) && !isContextArray(source)) {\n    return source;\n  } // Return 'undefined' if we already iterated over this 'source' to avoid infinite recursion\n\n\n  if (circularReferenceChecker.hasAlreadyBeenSeen(source)) {\n    return undefined;\n  } // 'source' and 'destination' are objects, merge them together\n\n\n  if (isContext(source) && (destination === undefined || isContext(destination))) {\n    var finalDestination = destination || {};\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        finalDestination[key] = mergeInto(finalDestination[key], source[key], circularReferenceChecker);\n      }\n    }\n\n    return finalDestination;\n  } // 'source' and 'destination' are arrays, merge them together\n\n\n  if (isContextArray(source) && (destination === undefined || isContextArray(destination))) {\n    var finalDestination = destination || [];\n    finalDestination.length = Math.max(finalDestination.length, source.length);\n\n    for (var index = 0; index < source.length; index += 1) {\n      finalDestination[index] = mergeInto(finalDestination[index], source[index], circularReferenceChecker);\n    }\n\n    return finalDestination;\n  } // The destination in not an array nor an object, so we can't merge it\n\n\n  return source;\n}","export function createContextManager() {\n  var context = {};\n  return {\n    get: function get() {\n      return context;\n    },\n    add: function add(key, value) {\n      context[key] = value;\n    },\n    remove: function remove(key) {\n      delete context[key];\n    },\n    set: function set(newContext) {\n      context = newContext;\n    }\n  };\n}","import { jsonStringify } from './utils';\nexport var ErrorSource = {\n  AGENT: 'agent',\n  CONSOLE: 'console',\n  CUSTOM: 'custom',\n  LOGGER: 'logger',\n  NETWORK: 'network',\n  SOURCE: 'source'\n};\nexport function formatUnknownError(stackTrace, errorObject, nonErrorPrefix) {\n  if (!stackTrace || stackTrace.message === undefined && !(errorObject instanceof Error)) {\n    return {\n      message: nonErrorPrefix + \" \" + jsonStringify(errorObject),\n      stack: 'No stack, consider using an instance of Error',\n      type: stackTrace && stackTrace.name\n    };\n  }\n\n  return {\n    message: stackTrace.message || 'Empty message',\n    stack: toStackTraceString(stackTrace),\n    type: stackTrace.name\n  };\n}\nexport function toStackTraceString(stack) {\n  var result = formatErrorMessage(stack);\n  stack.stack.forEach(function (frame) {\n    var func = frame.func === '?' ? '<anonymous>' : frame.func;\n    var args = frame.args && frame.args.length > 0 ? \"(\" + frame.args.join(', ') + \")\" : '';\n    var line = frame.line ? \":\" + frame.line : '';\n    var column = frame.line && frame.column ? \":\" + frame.column : '';\n    result += \"\\n  at \" + func + args + \" @ \" + frame.url + line + column;\n  });\n  return result;\n}\nexport function formatErrorMessage(stack) {\n  return (stack.name || 'Error') + \": \" + stack.message;\n}","import { deepClone } from './context';\n/**\n * Current limitations:\n * - field path do not support array, 'a.b.c' only\n * - modifiable fields type must be string\n */\n\nexport function limitModification(object, modifiableFieldPaths, modifier) {\n  var clone = deepClone(object);\n  var result = modifier(clone);\n  modifiableFieldPaths.forEach(function (path) {\n    var originalValue = get(object, path);\n    var newValue = get(clone, path);\n\n    if (typeof originalValue === 'string' && typeof newValue === 'string') {\n      set(object, path, newValue);\n    }\n  });\n  return result;\n}\n\nfunction get(object, path) {\n  var current = object;\n\n  for (var _i = 0, _a = path.split('.'); _i < _a.length; _i++) {\n    var field = _a[_i];\n\n    if (!isValidObjectContaining(current, field)) {\n      return;\n    }\n\n    current = current[field];\n  }\n\n  return current;\n}\n\nfunction set(object, path, value) {\n  var current = object;\n  var fields = path.split('.');\n\n  for (var i = 0; i < fields.length; i += 1) {\n    var field = fields[i];\n\n    if (!isValidObjectContaining(current, field)) {\n      return;\n    }\n\n    if (i !== fields.length - 1) {\n      current = current[field];\n    } else {\n      current[field] = value;\n    }\n  }\n}\n\nfunction isValidObjectContaining(object, field) {\n  return typeof object === 'object' && object !== null && field in object;\n}","var Observable =\n/** @class */\nfunction () {\n  function Observable() {\n    this.observers = [];\n  }\n\n  Observable.prototype.subscribe = function (f) {\n    this.observers.push(f);\n  };\n\n  Observable.prototype.notify = function (data) {\n    this.observers.forEach(function (observer) {\n      return observer(data);\n    });\n  };\n\n  return Observable;\n}();\n\nexport { Observable };","import { isNumber, round } from './utils';\nexport function toServerDuration(duration) {\n  if (!isNumber(duration)) {\n    return duration;\n  }\n\n  return round(duration * 1e6, 0);\n}\nexport function timeStampNow() {\n  return Date.now();\n}\nexport function relativeNow() {\n  return performance.now();\n}\nexport function elapsed(start, end) {\n  return end - start;\n}\n/**\n * Get the time since the navigation was started.\n *\n * Note: this does not use `performance.timeOrigin` because it doesn't seem to reflect the actual\n * time on which the navigation has started: it may be much farther in the past, at least in Firefox 71.\n * Related issue in Firefox: https://bugzilla.mozilla.org/show_bug.cgi?id=1429926\n */\n\nexport function getRelativeTime(timestamp) {\n  return timestamp - getNavigationStart();\n}\nexport function getTimeStamp(relativeTime) {\n  // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n  return Math.floor(getNavigationStart() + relativeTime);\n}\n/**\n * Navigation start slightly change on some rare cases\n */\n\nvar navigationStart;\n\nfunction getNavigationStart() {\n  if (navigationStart === undefined) {\n    navigationStart = performance.timing.navigationStart;\n  }\n\n  return navigationStart;\n}","import { getLinkElementOrigin, getLocationOrigin } from './utils';\nexport function normalizeUrl(url) {\n  return buildUrl(url, getLocationOrigin()).href;\n}\nexport function isValidUrl(url) {\n  try {\n    return !!buildUrl(url);\n  } catch (_a) {\n    return false;\n  }\n}\nexport function haveSameOrigin(url1, url2) {\n  return getOrigin(url1) === getOrigin(url2);\n}\nexport function getOrigin(url) {\n  return getLinkElementOrigin(buildUrl(url));\n}\nexport function getPathName(url) {\n  var pathname = buildUrl(url).pathname;\n  return pathname[0] === '/' ? pathname : \"/\" + pathname;\n}\nexport function getSearch(url) {\n  return buildUrl(url).search;\n}\nexport function getHash(url) {\n  return buildUrl(url).hash;\n}\nexport function buildUrl(url, base) {\n  if (checkURLSupported()) {\n    return base !== undefined ? new URL(url, base) : new URL(url);\n  }\n\n  if (base === undefined && !/:/.test(url)) {\n    throw new Error(\"Invalid URL: '\" + url + \"'\");\n  }\n\n  var doc = document;\n  var anchorElement = doc.createElement('a');\n\n  if (base !== undefined) {\n    doc = document.implementation.createHTMLDocument('');\n    var baseElement = doc.createElement('base');\n    baseElement.href = base;\n    doc.head.appendChild(baseElement);\n    doc.body.appendChild(anchorElement);\n  }\n\n  anchorElement.href = url;\n  return anchorElement;\n}\nvar isURLSupported;\n\nfunction checkURLSupported() {\n  if (isURLSupported !== undefined) {\n    return isURLSupported;\n  }\n\n  try {\n    var url = new URL('http://test/path');\n    isURLSupported = url.href === 'http://test/path';\n    return isURLSupported;\n  } catch (_a) {\n    isURLSupported = false;\n  }\n\n  return isURLSupported;\n}","import { monitor } from '../domain/internalMonitoring';\nexport var ONE_SECOND = 1000;\nexport var ONE_MINUTE = 60 * ONE_SECOND;\nexport var ONE_HOUR = 60 * ONE_MINUTE;\nexport var ONE_KILO_BYTE = 1024;\nexport var ResourceType;\n\n(function (ResourceType) {\n  ResourceType[\"DOCUMENT\"] = \"document\";\n  ResourceType[\"XHR\"] = \"xhr\";\n  ResourceType[\"BEACON\"] = \"beacon\";\n  ResourceType[\"FETCH\"] = \"fetch\";\n  ResourceType[\"CSS\"] = \"css\";\n  ResourceType[\"JS\"] = \"js\";\n  ResourceType[\"IMAGE\"] = \"image\";\n  ResourceType[\"FONT\"] = \"font\";\n  ResourceType[\"MEDIA\"] = \"media\";\n  ResourceType[\"OTHER\"] = \"other\";\n})(ResourceType || (ResourceType = {}));\n\nexport var RequestType;\n\n(function (RequestType) {\n  RequestType[\"FETCH\"] = \"fetch\";\n  RequestType[\"XHR\"] = \"xhr\";\n})(RequestType || (RequestType = {})); // use lodash API\n\n\nexport function throttle(fn, wait, options) {\n  var needLeadingExecution = options && options.leading !== undefined ? options.leading : true;\n  var needTrailingExecution = options && options.trailing !== undefined ? options.trailing : true;\n  var inWaitPeriod = false;\n  var pendingExecutionWithParameters;\n  var pendingTimeoutId;\n  return {\n    throttled: function throttled() {\n      var parameters = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        parameters[_i] = arguments[_i];\n      }\n\n      if (inWaitPeriod) {\n        pendingExecutionWithParameters = parameters;\n        return;\n      }\n\n      if (needLeadingExecution) {\n        fn.apply(void 0, parameters);\n      } else {\n        pendingExecutionWithParameters = parameters;\n      }\n\n      inWaitPeriod = true;\n      pendingTimeoutId = setTimeout(function () {\n        if (needTrailingExecution && pendingExecutionWithParameters) {\n          fn.apply(void 0, pendingExecutionWithParameters);\n        }\n\n        inWaitPeriod = false;\n        pendingExecutionWithParameters = undefined;\n      }, wait);\n    },\n    cancel: function cancel() {\n      clearTimeout(pendingTimeoutId);\n      inWaitPeriod = false;\n      pendingExecutionWithParameters = undefined;\n    }\n  };\n}\nexport function assign(target) {\n  var toAssign = [];\n\n  for (var _i = 1; _i < arguments.length; _i++) {\n    toAssign[_i - 1] = arguments[_i];\n  }\n\n  toAssign.forEach(function (source) {\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  });\n}\n/**\n * UUID v4\n * from https://gist.github.com/jed/982883\n */\n\nexport function generateUUID(placeholder) {\n  return placeholder ? // eslint-disable-next-line  no-bitwise\n  (parseInt(placeholder, 10) ^ Math.random() * 16 >> parseInt(placeholder, 10) / 4).toString(16) : (1e7 + \"-\" + 1e3 + \"-\" + 4e3 + \"-\" + 8e3 + \"-\" + 1e11).replace(/[018]/g, generateUUID);\n}\n/**\n * Return true if the draw is successful\n * @param threshold between 0 and 100\n */\n\nexport function performDraw(threshold) {\n  return threshold !== 0 && Math.random() * 100 <= threshold;\n}\nexport function round(num, decimals) {\n  return +num.toFixed(decimals);\n} // eslint-disable-next-line @typescript-eslint/no-empty-function\n\nexport function noop() {}\n/**\n * Custom implementation of JSON.stringify that ignores value.toJSON.\n * We need to do that because some sites badly override toJSON on certain objects.\n * Note this still supposes that JSON.stringify is correct...\n */\n\nexport function jsonStringify(value, replacer, space) {\n  if (value === null || value === undefined) {\n    return JSON.stringify(value);\n  }\n\n  var originalToJSON = [false, undefined];\n\n  if (hasToJSON(value)) {\n    // We need to add a flag and not rely on the truthiness of value.toJSON\n    // because it can be set but undefined and that's actually significant.\n    originalToJSON = [true, value.toJSON];\n    delete value.toJSON;\n  }\n\n  var originalProtoToJSON = [false, undefined];\n  var prototype;\n\n  if (typeof value === 'object') {\n    prototype = Object.getPrototypeOf(value);\n\n    if (hasToJSON(prototype)) {\n      originalProtoToJSON = [true, prototype.toJSON];\n      delete prototype.toJSON;\n    }\n  }\n\n  var result;\n\n  try {\n    result = JSON.stringify(value, replacer, space);\n  } catch (_a) {\n    result = '<error: unable to serialize object>';\n  } finally {\n    if (originalToJSON[0]) {\n      ;\n      value.toJSON = originalToJSON[1];\n    }\n\n    if (originalProtoToJSON[0]) {\n      ;\n      prototype.toJSON = originalProtoToJSON[1];\n    }\n  }\n\n  return result;\n}\n\nfunction hasToJSON(value) {\n  return typeof value === 'object' && value !== null && value.hasOwnProperty('toJSON');\n}\n\nexport function includes(candidate, search) {\n  return candidate.indexOf(search) !== -1;\n}\nexport function find(array, predicate) {\n  for (var i = 0; i < array.length; i += 1) {\n    var item = array[i];\n\n    if (predicate(item, i, array)) {\n      return item;\n    }\n  }\n\n  return undefined;\n}\nexport function isPercentage(value) {\n  return isNumber(value) && value >= 0 && value <= 100;\n}\nexport function isNumber(value) {\n  return typeof value === 'number';\n}\nexport function objectValues(object) {\n  var values = [];\n  Object.keys(object).forEach(function (key) {\n    values.push(object[key]);\n  });\n  return values;\n}\nexport function objectEntries(object) {\n  return Object.keys(object).map(function (key) {\n    return [key, object[key]];\n  });\n}\nexport function isEmptyObject(object) {\n  return Object.keys(object).length === 0;\n}\nexport function mapValues(object, fn) {\n  var newObject = {};\n\n  for (var _i = 0, _a = Object.keys(object); _i < _a.length; _i++) {\n    var key = _a[_i];\n    newObject[key] = fn(object[key]);\n  }\n\n  return newObject;\n}\n/**\n * inspired by https://mathiasbynens.be/notes/globalthis\n */\n\nexport function getGlobalObject() {\n  if (typeof globalThis === 'object') {\n    return globalThis;\n  }\n\n  Object.defineProperty(Object.prototype, '_dd_temp_', {\n    get: function get() {\n      return this;\n    },\n    configurable: true\n  }); // @ts-ignore _dd_temp is defined using defineProperty\n\n  var globalObject = _dd_temp_; // @ts-ignore _dd_temp is defined using defineProperty\n\n  delete Object.prototype._dd_temp_; // eslint-disable-line no-underscore-dangle\n\n  if (typeof globalObject !== 'object') {\n    // on safari _dd_temp_ is available on window but not globally\n    // fallback on other browser globals check\n    if (typeof self === 'object') {\n      globalObject = self;\n    } else if (typeof window === 'object') {\n      globalObject = window;\n    } else {\n      globalObject = {};\n    }\n  }\n\n  return globalObject;\n}\nexport function getLocationOrigin() {\n  return getLinkElementOrigin(window.location);\n}\n/**\n * IE fallback\n * https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/origin\n */\n\nexport function getLinkElementOrigin(element) {\n  if (element.origin) {\n    return element.origin;\n  }\n\n  var sanitizedHost = element.host.replace(/(:80|:443)$/, '');\n  return element.protocol + \"//\" + sanitizedHost;\n}\nexport function findCommaSeparatedValue(rawString, name) {\n  var regex = new RegExp(\"(?:^|;)\\\\s*\" + name + \"\\\\s*=\\\\s*([^;]+)\");\n  var matches = regex.exec(rawString);\n  return matches ? matches[1] : undefined;\n}\nexport function safeTruncate(candidate, length) {\n  var lastChar = candidate.charCodeAt(length - 1); // check if it is the high part of a surrogate pair\n\n  if (lastChar >= 0xd800 && lastChar <= 0xdbff) {\n    return candidate.slice(0, length + 1);\n  }\n\n  return candidate.slice(0, length);\n}\n/**\n * Add an event listener to an event emitter object (Window, Element, mock object...).  This provides\n * a few conveniences compared to using `element.addEventListener` directly:\n *\n * * supports IE11 by: using an option object only if needed and emulating the `once` option\n *\n * * wraps the listener with a `monitor` function\n *\n * * returns a `stop` function to remove the listener\n */\n\nexport function addEventListener(emitter, event, listener, options) {\n  return addEventListeners(emitter, [event], listener, options);\n}\n/**\n * Add event listeners to an event emitter object (Window, Element, mock object...).  This provides\n * a few conveniences compared to using `element.addEventListener` directly:\n *\n * * supports IE11 by: using an option object only if needed and emulating the `once` option\n *\n * * wraps the listener with a `monitor` function\n *\n * * returns a `stop` function to remove the listener\n *\n * * with `once: true`, the listener will be called at most once, even if different events are listened\n */\n\nexport function addEventListeners(emitter, events, listener, _a) {\n  var _b = _a === void 0 ? {} : _a,\n      once = _b.once,\n      capture = _b.capture,\n      passive = _b.passive;\n\n  var wrappedListener = monitor(once ? function (event) {\n    stop();\n    listener(event);\n  } : listener);\n  var options = passive ? {\n    capture: capture,\n    passive: passive\n  } : capture;\n  events.forEach(function (event) {\n    return emitter.addEventListener(event, wrappedListener, options);\n  });\n\n  var stop = function stop() {\n    return events.forEach(function (event) {\n      return emitter.removeEventListener(event, wrappedListener, options);\n    });\n  };\n\n  return {\n    stop: stop\n  };\n}\nexport function runOnReadyState(expectedReadyState, callback) {\n  if (document.readyState === expectedReadyState || document.readyState === 'complete') {\n    callback();\n  } else {\n    var eventName = expectedReadyState === 'complete' ? \"load\"\n    /* LOAD */\n    : \"DOMContentLoaded\"\n    /* DOM_CONTENT_LOADED */\n    ;\n    addEventListener(window, eventName, callback, {\n      once: true\n    });\n  }\n}","import { __spreadArrays } from \"tslib\";\nimport { getTimeStamp, relativeNow } from '../tools/timeUtils';\nimport { addEventListener, jsonStringify, noop, objectValues } from '../tools/utils'; // https://en.wikipedia.org/wiki/UTF-8\n\nvar HAS_MULTI_BYTES_CHARACTERS = /[^\\u0000-\\u007F]/;\n/**\n * Use POST request without content type to:\n * - avoid CORS preflight requests\n * - allow usage of sendBeacon\n *\n * multiple elements are sent separated by \\n in order\n * to be parsed correctly without content type header\n */\n\nvar HttpRequest =\n/** @class */\nfunction () {\n  function HttpRequest(endpointUrl, bytesLimit, withBatchTime) {\n    if (withBatchTime === void 0) {\n      withBatchTime = false;\n    }\n\n    this.endpointUrl = endpointUrl;\n    this.bytesLimit = bytesLimit;\n    this.withBatchTime = withBatchTime;\n  }\n\n  HttpRequest.prototype.send = function (data, size) {\n    var url = this.withBatchTime ? addBatchTime(this.endpointUrl) : this.endpointUrl;\n\n    if (navigator.sendBeacon && size < this.bytesLimit) {\n      var isQueued = navigator.sendBeacon(url, data);\n\n      if (isQueued) {\n        return;\n      }\n    }\n\n    var request = new XMLHttpRequest();\n    request.open('POST', url, true);\n    request.send(data);\n  };\n\n  return HttpRequest;\n}();\n\nexport { HttpRequest };\n\nfunction addBatchTime(url) {\n  return \"\" + url + (url.indexOf('?') === -1 ? '?' : '&') + \"batch_time=\" + new Date().getTime() + \"&m_time=\" + getTimeStamp(relativeNow());\n}\n\nvar Batch =\n/** @class */\nfunction () {\n  function Batch(request, maxSize, bytesLimit, maxMessageSize, flushTimeout, beforeUnloadCallback) {\n    if (beforeUnloadCallback === void 0) {\n      beforeUnloadCallback = noop;\n    }\n\n    this.request = request;\n    this.maxSize = maxSize;\n    this.bytesLimit = bytesLimit;\n    this.maxMessageSize = maxMessageSize;\n    this.flushTimeout = flushTimeout;\n    this.beforeUnloadCallback = beforeUnloadCallback;\n    this.pushOnlyBuffer = [];\n    this.upsertBuffer = {};\n    this.bufferBytesSize = 0;\n    this.bufferMessageCount = 0;\n    this.flushOnVisibilityHidden();\n    this.flushPeriodically();\n  }\n\n  Batch.prototype.add = function (message) {\n    this.addOrUpdate(message);\n  };\n\n  Batch.prototype.upsert = function (message, key) {\n    this.addOrUpdate(message, key);\n  };\n\n  Batch.prototype.flush = function () {\n    if (this.bufferMessageCount !== 0) {\n      var messages = __spreadArrays(this.pushOnlyBuffer, objectValues(this.upsertBuffer));\n\n      this.request.send(messages.join('\\n'), this.bufferBytesSize);\n      this.pushOnlyBuffer = [];\n      this.upsertBuffer = {};\n      this.bufferBytesSize = 0;\n      this.bufferMessageCount = 0;\n    }\n  };\n\n  Batch.prototype.sizeInBytes = function (candidate) {\n    // Accurate byte size computations can degrade performances when there is a lot of events to process\n    if (!HAS_MULTI_BYTES_CHARACTERS.test(candidate)) {\n      return candidate.length;\n    }\n\n    if (window.TextEncoder !== undefined) {\n      return new TextEncoder().encode(candidate).length;\n    }\n\n    return new Blob([candidate]).size;\n  };\n\n  Batch.prototype.addOrUpdate = function (message, key) {\n    var _a = this.process(message),\n        processedMessage = _a.processedMessage,\n        messageBytesSize = _a.messageBytesSize;\n\n    if (messageBytesSize >= this.maxMessageSize) {\n      console.warn(\"Discarded a message whose size was bigger than the maximum allowed size \" + this.maxMessageSize + \"KB.\");\n      return;\n    }\n\n    if (this.hasMessageFor(key)) {\n      this.remove(key);\n    }\n\n    if (this.willReachedBytesLimitWith(messageBytesSize)) {\n      this.flush();\n    }\n\n    this.push(processedMessage, messageBytesSize, key);\n\n    if (this.isFull()) {\n      this.flush();\n    }\n  };\n\n  Batch.prototype.process = function (message) {\n    var processedMessage = jsonStringify(message);\n    var messageBytesSize = this.sizeInBytes(processedMessage);\n    return {\n      processedMessage: processedMessage,\n      messageBytesSize: messageBytesSize\n    };\n  };\n\n  Batch.prototype.push = function (processedMessage, messageBytesSize, key) {\n    if (this.bufferMessageCount > 0) {\n      // \\n separator at serialization\n      this.bufferBytesSize += 1;\n    }\n\n    if (key !== undefined) {\n      this.upsertBuffer[key] = processedMessage;\n    } else {\n      this.pushOnlyBuffer.push(processedMessage);\n    }\n\n    this.bufferBytesSize += messageBytesSize;\n    this.bufferMessageCount += 1;\n  };\n\n  Batch.prototype.remove = function (key) {\n    var removedMessage = this.upsertBuffer[key];\n    delete this.upsertBuffer[key];\n    var messageBytesSize = this.sizeInBytes(removedMessage);\n    this.bufferBytesSize -= messageBytesSize;\n    this.bufferMessageCount -= 1;\n\n    if (this.bufferMessageCount > 0) {\n      this.bufferBytesSize -= 1;\n    }\n  };\n\n  Batch.prototype.hasMessageFor = function (key) {\n    return key !== undefined && this.upsertBuffer[key] !== undefined;\n  };\n\n  Batch.prototype.willReachedBytesLimitWith = function (messageBytesSize) {\n    // byte of the separator at the end of the message\n    return this.bufferBytesSize + messageBytesSize + 1 >= this.bytesLimit;\n  };\n\n  Batch.prototype.isFull = function () {\n    return this.bufferMessageCount === this.maxSize || this.bufferBytesSize >= this.bytesLimit;\n  };\n\n  Batch.prototype.flushPeriodically = function () {\n    var _this = this;\n\n    setTimeout(function () {\n      _this.flush();\n\n      _this.flushPeriodically();\n    }, this.flushTimeout);\n  };\n\n  Batch.prototype.flushOnVisibilityHidden = function () {\n    var _this = this;\n    /**\n     * With sendBeacon, requests are guaranteed to be successfully sent during document unload\n     */\n    // @ts-ignore this function is not always defined\n\n\n    if (navigator.sendBeacon) {\n      /**\n       * beforeunload is called before visibilitychange\n       * register first to be sure to be called before flush on beforeunload\n       * caveat: unload can still be canceled by another listener\n       */\n      addEventListener(window, \"beforeunload\"\n      /* BEFORE_UNLOAD */\n      , this.beforeUnloadCallback);\n      /**\n       * Only event that guarantee to fire on mobile devices when the page transitions to background state\n       * (e.g. when user switches to a different application, goes to homescreen, etc), or is being unloaded.\n       */\n\n      addEventListener(document, \"visibilitychange\"\n      /* VISIBILITY_CHANGE */\n      , function () {\n        if (document.visibilityState === 'hidden') {\n          _this.flush();\n        }\n      });\n      /**\n       * Safari does not support yet to send a request during:\n       * - a visibility change during doc unload (cf: https://bugs.webkit.org/show_bug.cgi?id=194897)\n       * - a page hide transition (cf: https://bugs.webkit.org/show_bug.cgi?id=188329)\n       */\n\n      addEventListener(window, \"beforeunload\"\n      /* BEFORE_UNLOAD */\n      , function () {\n        return _this.flush();\n      });\n    }\n  };\n\n  return Batch;\n}();\n\nexport { Batch };"],"sourceRoot":""}